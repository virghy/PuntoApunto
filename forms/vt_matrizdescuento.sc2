*--------------------------------------------------------------------------------------------------------------------------------------------------------
* (ES) AUTOGENERADO - ¡¡ATENCIÓN!! - ¡¡NO PENSADO PARA EJECUTAR!! USAR SOLAMENTE PARA INTEGRAR CAMBIOS Y ALMACENAR CON HERRAMIENTAS SCM!!
* (EN) AUTOGENERATED - ATTENTION!! - NOT INTENDED FOR EXECUTION!! USE ONLY FOR MERGING CHANGES AND STORING WITH SCM TOOLS!!
*--------------------------------------------------------------------------------------------------------------------------------------------------------
*< FOXBIN2PRG: Version="1.19" SourceFile="vt_matrizdescuento.scx" /> (Solo para binarios VFP 9 / Only for VFP 9 binaries)
*
*
DEFINE CLASS dataenvironment AS dataenvironment 
 	*< CLASSDATA: Baseclass="dataenvironment" Timestamp="" Scale="" Uniqueid="" ClassIcon="1" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Cursor1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor2" UniqueID="" Timestamp="" />

	DataSource = .NULL.
	Height = 200
	Left = 428
	Name = "Dataenvironment"
	Top = 160
	Width = 520

	ADD OBJECT 'Cursor1' AS cursor WITH ;
		Alias = "vt_matrizdescuento", ;
		CursorSource = "vt_matrizdescuento", ;
		Database = ..\data\datos.dbc, ;
		Height = 90, ;
		Left = 10, ;
		Name = "Cursor1", ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor2' AS cursor WITH ;
		Alias = "vt_matrizproducto", ;
		BufferModeOverride = 5, ;
		CursorSource = "vt_matrizproducto", ;
		Database = ..\data\datos.dbc, ;
		Height = 133, ;
		Left = 150, ;
		Name = "Cursor2", ;
		NoDataOnLoad = .T., ;
		Top = 20, ;
		Width = 159
		*< END OBJECT: BaseClass="cursor" />

ENDDEFINE

DEFINE CLASS tsmaintform12 AS tsmaintform OF "..\libs\tsbase.vcx" 
 	*< CLASSDATA: Baseclass="form" Timestamp="" Scale="" Uniqueid="" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.txtIdmatriz" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.lblIdmatriz" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.lblIdlistabase" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.txtDfecha" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.lblDfecha" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.txtHfecha" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.lblHfecha" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.txtDescuento" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.lblDescuento" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Cbolistaprecio1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tscheckbox1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.txtDescripcion" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.lblDescripcion" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.grdVt_matrizproducto" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.grdVt_matrizproducto.Column4.Header1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.grdVt_matrizproducto.Column4.Idproducto1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.grdVt_matrizproducto.Column5.Header1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.grdVt_matrizproducto.Column5.Idproducto1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.grdVt_matrizproducto.Column6.Header1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.grdVt_matrizproducto.Column6.Familia" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.grdVt_matrizproducto.Column10.Header1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.grdVt_matrizproducto.Column10.Tscheckbox1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.grdVt_matrizproducto.Column13.Header1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.grdVt_matrizproducto.Column13.Tscombobox1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.grdVt_matrizproducto.Column14.Header1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.grdVt_matrizproducto.Column14.linea" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.grdVt_matrizproducto.Column7.Header1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.grdVt_matrizproducto.Column7.Tscombobox1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tscommandbutton1" UniqueID="" Timestamp="" />

	campos = IdMatriz,IdEmpresa,Activo
	Caption = "Matriz de Descuentos"
	DataSession = 1
	DoCreate = .T.
	Height = 415
	Name = "Tsmaintform12"
	tabla1 = vt_MatrizDescuento
	tabla2 = vt_MatrizProducto
	valores = newId('vt_Matriz'),oApp.Empresa,.t.
	Width = 796
	lblRequerido.Name = "lblRequerido"
	Pageframe1.ErasePage = .T.
	Pageframe1.Height = 416
	Pageframe1.Left = 0
	Pageframe1.Name = "Pageframe1"
	Pageframe1.Page1.Name = "Page1"
	Pageframe1.Page2.grdList.Name = "grdList"
	Pageframe1.Page2.Name = "Page2"
	Pageframe1.Top = 0
	Pageframe1.Width = 792

	ADD OBJECT 'Pageframe1.Page1.Cbolistaprecio1' AS cbolistaprecio WITH ;
		ControlSource = "vt_matrizdescuento.idlistabase", ;
		Height = 22, ;
		Left = 107, ;
		Name = "Cbolistaprecio1", ;
		TabIndex = 8, ;
		Top = 94, ;
		Width = 96
		*< END OBJECT: ClassLib="..\libs\futura.vcx" BaseClass="combobox" />

	ADD OBJECT 'Pageframe1.Page1.grdVt_matrizproducto' AS tsgrid WITH ;
		campo = IdMatriz,IdEmpresa,Activo, ;
		ColumnCount = 7, ;
		editable = .T., ;
		FontSize = 8, ;
		Height = 200, ;
		Left = 11, ;
		Name = "grdVt_matrizproducto", ;
		Panel = 1, ;
		RecordSource = "vt_matrizproducto", ;
		RecordSourceType = 1, ;
		RowHeight = 17, ;
		TabIndex = 14, ;
		Top = 179, ;
		valor = vt_matrizDescuento.IdMatriz,oApp.Empresa,.t., ;
		valorvariable = vt_matrizDescuento.IdMatriz, ;
		variablevista = m.IdMatriz, ;
		Width = 756, ;
		Column1.ControlSource = "vt_matrizproducto.didproducto", ;
		Column1.FontSize = 8, ;
		Column1.Name = "Column4", ;
		Column1.Width = 81, ;
		Column2.ControlSource = "vt_matrizproducto.hidproducto", ;
		Column2.FontSize = 8, ;
		Column2.Name = "Column5", ;
		Column2.Width = 83, ;
		Column3.ControlSource = "vt_matrizproducto.idfamilia", ;
		Column3.FontSize = 8, ;
		Column3.Name = "Column6", ;
		Column3.Sparse = .F., ;
		Column3.Width = 122, ;
		Column4.ColumnOrder = 7, ;
		Column4.ControlSource = "vt_matrizproducto.activo", ;
		Column4.FontSize = 8, ;
		Column4.Name = "Column10", ;
		Column4.Sparse = .F., ;
		Column4.Width = 40, ;
		Column5.ColumnOrder = 6, ;
		Column5.ControlSource = "vt_matrizproducto.idformapago", ;
		Column5.FontSize = 8, ;
		Column5.Name = "Column13", ;
		Column5.Sparse = .F., ;
		Column5.Width = 103, ;
		Column6.ColumnOrder = 4, ;
		Column6.ControlSource = "vt_matrizproducto.idlinea", ;
		Column6.FontSize = 8, ;
		Column6.Name = "Column14", ;
		Column6.Sparse = .F., ;
		Column6.Width = 110, ;
		Column7.ColumnOrder = 5, ;
		Column7.ControlSource = "vt_matrizproducto.idmarca", ;
		Column7.FontSize = 8, ;
		Column7.Name = "Column7", ;
		Column7.Sparse = .F., ;
		Column7.Width = 103
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="grid" />

	ADD OBJECT 'Pageframe1.Page1.grdVt_matrizproducto.Column10.Header1' AS header WITH ;
		Caption = "Activo", ;
		FontSize = 8, ;
		Name = "Header1"
		*< END OBJECT: BaseClass="header" />

	ADD OBJECT 'Pageframe1.Page1.grdVt_matrizproducto.Column10.Tscheckbox1' AS tscheckbox WITH ;
		Alignment = 0, ;
		Caption = "", ;
		Left = 27, ;
		Name = "Tscheckbox1", ;
		Top = 34
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="checkbox" />

	ADD OBJECT 'Pageframe1.Page1.grdVt_matrizproducto.Column13.Header1' AS header WITH ;
		Caption = "Forma Pago", ;
		FontSize = 8, ;
		Name = "Header1"
		*< END OBJECT: BaseClass="header" />

	ADD OBJECT 'Pageframe1.Page1.grdVt_matrizproducto.Column13.Tscombobox1' AS tscombobox WITH ;
		BorderStyle = 0, ;
		BoundColumn = 2, ;
		cmdsql = Select Forma,IdForma from vt_tpvForma where IdEmpresa = ?oApp.Empresa Union Select '(Todos)', '-1'  order by 1, ;
		cursor = cTpvForma, ;
		Left = 43, ;
		Name = "Tscombobox1", ;
		Top = 34
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="combobox" />

	ADD OBJECT 'Pageframe1.Page1.grdVt_matrizproducto.Column14.Header1' AS header WITH ;
		Caption = "Linea", ;
		FontSize = 8, ;
		Name = "Header1"
		*< END OBJECT: BaseClass="header" />

	ADD OBJECT 'Pageframe1.Page1.grdVt_matrizproducto.Column14.linea' AS tscombobox WITH ;
		BorderStyle = 0, ;
		BoundColumn = 2, ;
		cmdsql = Select descripcion,idlinea,IdFamilia from st_linea where idempresa = ?oApp.Empresa  Union Select '(Todos)', '-1' ,'-1' order by 1, ;
		ColumnCount = 2, ;
		ColumnWidths = "95,0", ;
		ControlSource = "vt_matrizproducto.idlinea", ;
		cursor = clinea, ;
		editable = .T., ;
		FirstElement = 1, ;
		Height = 22, ;
		Left = 291, ;
		Name = "linea", ;
		NumberOfElements = 0, ;
		RowSourceType = 3, ;
		Style = 2, ;
		TabIndex = 12, ;
		Top = 182, ;
		Width = 98, ;
		ZOrderSet = 39
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="combobox" />

	ADD OBJECT 'Pageframe1.Page1.grdVt_matrizproducto.Column4.Header1' AS header WITH ;
		Caption = "Desde Prod.", ;
		FontSize = 8, ;
		Name = "Header1"
		*< END OBJECT: BaseClass="header" />

	ADD OBJECT 'Pageframe1.Page1.grdVt_matrizproducto.Column4.Idproducto1' AS idproducto WITH ;
		Left = 354, ;
		Name = "Idproducto1", ;
		retorna = , ;
		SelectedBackColor = 247,223,187, ;
		SelectedForeColor = 0,64,128, ;
		Top = 108
		*< END OBJECT: ClassLib="..\libs\futura.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page1.grdVt_matrizproducto.Column5.Header1' AS header WITH ;
		Caption = "Hasta Prod", ;
		FontSize = 8, ;
		Name = "Header1"
		*< END OBJECT: BaseClass="header" />

	ADD OBJECT 'Pageframe1.Page1.grdVt_matrizproducto.Column5.Idproducto1' AS idproducto WITH ;
		Left = 354, ;
		Name = "Idproducto1", ;
		retorna = , ;
		SelectedBackColor = 247,223,187, ;
		SelectedForeColor = 0,64,128, ;
		Top = 108
		*< END OBJECT: ClassLib="..\libs\futura.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page1.grdVt_matrizproducto.Column6.Familia' AS tscombobox WITH ;
		BorderStyle = 0, ;
		BoundColumn = 2, ;
		cmdsql = Select descripcion,idfamilia from st_familia where idempresa = ?oApp.Empresa Union Select '(Todos)', '-1'  order by 1, ;
		ColumnCount = 2, ;
		ColumnWidths = "145,0", ;
		ControlSource = "vt_matrizproducto.idfamilia", ;
		cursor = cFamilia, ;
		editable = .T., ;
		FirstElement = 1, ;
		Height = 22, ;
		Left = 59, ;
		Name = "Familia", ;
		NumberOfElements = 0, ;
		RowSource = "", ;
		RowSourceType = 3, ;
		Style = 2, ;
		TabIndex = 10, ;
		Top = 182, ;
		Width = 148, ;
		ZOrderSet = 38
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="combobox" />

	ADD OBJECT 'Pageframe1.Page1.grdVt_matrizproducto.Column6.Header1' AS header WITH ;
		Caption = "Familia", ;
		FontSize = 8, ;
		Name = "Header1"
		*< END OBJECT: BaseClass="header" />

	ADD OBJECT 'Pageframe1.Page1.grdVt_matrizproducto.Column7.Header1' AS header WITH ;
		Caption = "Marca", ;
		FontSize = 8, ;
		Name = "Header1"
		*< END OBJECT: BaseClass="header" />

	ADD OBJECT 'Pageframe1.Page1.grdVt_matrizproducto.Column7.Tscombobox1' AS tscombobox WITH ;
		BorderStyle = 0, ;
		BoundColumn = 2, ;
		BoundTo = .T., ;
		cmdsql = Select Descripcion,IdMarca from st_Marca where IdEmpresa=?oApp.Empresa Union Select '(Todos)', '-1'  order by 1, ;
		cursor = cMarca, ;
		Left = 527, ;
		Name = "Tscombobox1", ;
		Top = 118
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="combobox" />

	ADD OBJECT 'Pageframe1.Page1.lblDescripcion' AS tslabel WITH ;
		Caption = "Descripcion", ;
		Height = 16, ;
		Left = 35, ;
		Name = "lblDescripcion", ;
		TabIndex = 11, ;
		Top = 142, ;
		Width = 67
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page1.lblDescuento' AS tslabel WITH ;
		AutoSize = .F., ;
		Caption = "Descuento", ;
		Height = 16, ;
		Left = 35, ;
		Name = "lblDescuento", ;
		TabIndex = 9, ;
		Top = 118, ;
		Width = 61
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page1.lblDfecha' AS tslabel WITH ;
		AutoSize = .F., ;
		Caption = "Desde fecha", ;
		Height = 16, ;
		Left = 35, ;
		Name = "lblDfecha", ;
		TabIndex = 3, ;
		Top = 70, ;
		Width = 70
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page1.lblHfecha' AS tslabel WITH ;
		Caption = "Hasta fecha", ;
		Height = 16, ;
		Left = 311, ;
		Name = "lblHfecha", ;
		TabIndex = 5, ;
		Top = 70, ;
		Width = 70
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page1.lblIdlistabase' AS tslabel WITH ;
		AutoSize = .F., ;
		Caption = "Lista Base", ;
		Height = 16, ;
		Left = 35, ;
		Name = "lblIdlistabase", ;
		TabIndex = 7, ;
		Top = 94, ;
		Width = 59
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page1.lblIdmatriz' AS tslabel WITH ;
		AutoSize = .F., ;
		Caption = "Id Matriz", ;
		Height = 16, ;
		Left = 35, ;
		Name = "lblIdmatriz", ;
		TabIndex = 1, ;
		Top = 46, ;
		Width = 49
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page1.Tscheckbox1' AS tscheckbox WITH ;
		Alignment = 1, ;
		Caption = "Activo", ;
		ControlSource = "vt_matrizdescuento.activo", ;
		Height = 15, ;
		Left = 383, ;
		Name = "Tscheckbox1", ;
		TabIndex = 13, ;
		Top = 46, ;
		Width = 96
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="checkbox" />

	ADD OBJECT 'Pageframe1.Page1.Tscommandbutton1' AS tscommandbutton WITH ;
		Caption = "Ver Producto afectados...", ;
		Height = 26, ;
		Left = 563, ;
		Name = "Tscommandbutton1", ;
		Top = 118, ;
		Width = 192
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'Pageframe1.Page1.txtDescripcion' AS tstextbox WITH ;
		Comment = "", ;
		ControlSource = "vt_matrizdescuento.descripcion", ;
		Height = 22, ;
		Left = 107, ;
		MaxLength = 50, ;
		Name = "txtDescripcion", ;
		TabIndex = 12, ;
		Top = 142, ;
		Width = 372
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page1.txtDescuento' AS tstextbox WITH ;
		Comment = "", ;
		ControlSource = "vt_matrizdescuento.descuento", ;
		Height = 22, ;
		InputMask = "999%", ;
		Left = 107, ;
		Name = "txtDescuento", ;
		TabIndex = 10, ;
		Top = 118, ;
		Width = 96
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page1.txtDfecha' AS tstextbox WITH ;
		Comment = "", ;
		ControlSource = "vt_matrizdescuento.dfecha", ;
		Height = 22, ;
		Left = 107, ;
		Name = "txtDfecha", ;
		Seconds = 0, ;
		TabIndex = 4, ;
		Top = 70, ;
		Width = 96
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page1.txtHfecha' AS tstextbox WITH ;
		Comment = "", ;
		ControlSource = "vt_matrizdescuento.hfecha", ;
		Height = 22, ;
		Left = 383, ;
		Name = "txtHfecha", ;
		Seconds = 0, ;
		TabIndex = 6, ;
		Top = 70, ;
		Width = 96
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page1.txtIdmatriz' AS tstextbox WITH ;
		Comment = "", ;
		ControlSource = "vt_matrizdescuento.idmatriz", ;
		Height = 22, ;
		Left = 107, ;
		Name = "txtIdmatriz", ;
		TabIndex = 2, ;
		Top = 46, ;
		Width = 96
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />
	
	PROCEDURE validar
		SELECT vt_matrizProducto
		SCAN 
			IF EMPTY(dIdProducto)
				replace dIdProducto WITH null 
			ENDIF
			IF EMPTY(hIdProducto)
				replace hIdProducto WITH null 
			ENDIF
			IF EMPTY(IdFamilia)
				replace IdFamilia WITH null 
			ENDIF
			IF EMPTY(IdLinea)
				replace IdLinea WITH null 
			ENDIF
			IF EMPTY(IdFormaPago)
				replace IdFormaPago WITH null 
			ENDIF
		
		ENDSCAN
		
	ENDPROC

	PROCEDURE Pageframe1.Page1.grdVt_matrizproducto.Column14.linea.GotFocus
		SET FILTER TO (IdFamilia = cFamilia.IdFamilia OR IdFamilia = '-1') IN cLinea
		this.Refresh()
		*GO RECNO('cLinea') IN cLinea
	ENDPROC

	PROCEDURE Pageframe1.Page1.grdVt_matrizproducto.Column14.linea.LostFocus
		SET FILTER TO IN cLinea
		*GO RECNO('cLinea') IN cLinea
		this.Refresh()
	ENDPROC

	PROCEDURE Pageframe1.Page1.grdVt_matrizproducto.Column6.Familia.InteractiveChange
		*This.parent.parent.Column14.linea.Requery()
		replace IdLinea WITH '-1' IN vt_matrizProducto
		
	ENDPROC

	PROCEDURE Pageframe1.Page1.grdVt_matrizproducto.Column6.Familia.ProgrammaticChange
		*This.parent.parent.Column14.linea.Requery()
	ENDPROC

	PROCEDURE Pageframe1.Page1.grdVt_matrizproducto.Column6.Familia.Refresh
		
		DODEFAULT()
		*This.parent.parent.Column14.linea.Requery()
	ENDPROC

	PROCEDURE Pageframe1.Page1.Tscommandbutton1.Click
		TEXT TO cmdSQL noshow
			SELECT     pr.IdProducto, pr.Descripcion, f.IdFamilia, f.Descripcion AS Familia, m.IdMarca, m.Descripcion AS Marca, l.IdLinea, l.Descripcion AS Linea
			FROM         st_Producto AS pr LEFT OUTER JOIN
		              st_Familia AS f ON pr.IdEmpresa = f.IdEmpresa AND pr.Familia = f.IdFamilia LEFT OUTER JOIN
		              st_Linea AS l ON pr.IdEmpresa = l.IdEmpresa AND pr.Linea = l.IdLinea LEFT OUTER JOIN
		              st_Marca AS m ON pr.IdEmpresa = m.IdEmpresa AND pr.Marca = m.IdMarca
			where pr.IdEmpresa=?oApp.Empresa
			and exists(SELECT md.*    
		FROM         vt_MatrizProductos AS mp INNER JOIN
		                      vt_MatrizDescuento AS md ON mp.IdMatriz = md.IdMatriz 
		where exists(Select * from st_Producto AS p where md.IdEmpresa = p.IdEmpresa
		and p.IdProducto=pr.IdProducto
		and ((p.IdProducto between mp.dIdProducto and mp.hIdProducto)
			  or (mp.dIdProducto is null and p.IdProducto<mp.hIdProducto)
			  or (mp.hIdProducto is null and p.idProducto>mp.dIdProducto)
			  or (mp.dIdProducto is null and mp.hIdProducto is null))
		and (p.Familia = mp.IdFamilia or mp.IdFamilia='-1')
		and (p.Linea = mp.IdLinea or mp.IdLinea='-1')
		and (p.Marca = mp.IdMarca or mp.IdMarca=-1)
		)
		and md.IdMatriz = ?vt_matrizdescuento.idmatriz
		and md.Idempresa=?oApp.Empresa
		and md.Activo=1
		and mp.Activo=1
		and getdate() between dFecha and hFecha)
		
		ENDTEXT
		
		IF thisform.runsql(cmdSQL,"cProductos")>0
			SELECT cProductos
			BROWSE 
		ENDIF
		
		
		
	ENDPROC

	PROCEDURE Pageframe1.Page1.Tscommandbutton1.Refresh
		this.Enabled=!thisform.editmode
	ENDPROC

ENDDEFINE
