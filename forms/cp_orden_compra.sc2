*--------------------------------------------------------------------------------------------------------------------------------------------------------
* (ES) AUTOGENERADO - ¡¡ATENCIÓN!! - ¡¡NO PENSADO PARA EJECUTAR!! USAR SOLAMENTE PARA INTEGRAR CAMBIOS Y ALMACENAR CON HERRAMIENTAS SCM!!
* (EN) AUTOGENERATED - ATTENTION!! - NOT INTENDED FOR EXECUTION!! USE ONLY FOR MERGING CHANGES AND STORING WITH SCM TOOLS!!
*--------------------------------------------------------------------------------------------------------------------------------------------------------
*< FOXBIN2PRG: Version="1.19" SourceFile="cp_orden_compra.scx" /> (Solo para binarios VFP 9 / Only for VFP 9 binaries)
*
*
#INCLUDE "..\include\tastrade.h"

DEFINE CLASS dataenvironment AS dataenvironment 
 	*< CLASSDATA: Baseclass="dataenvironment" Timestamp="" Scale="" Uniqueid="" ClassIcon="2" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Cursor1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor2" UniqueID="" Timestamp="" />

	DataSource = .NULL.
	Height = 384
	InitialSelectedAlias = "cp_vorden_compra"
	Left = 1
	Name = "Dataenvironment"
	Top = 26
	Width = 792

	ADD OBJECT 'Cursor1' AS cursor WITH ;
		Alias = "cp_vdet_ord", ;
		BufferModeOverride = 5, ;
		CursorSource = "cp_vdet_ord", ;
		Database = ..\data\datos.dbc, ;
		Height = 207, ;
		Left = 10, ;
		Name = "Cursor1", ;
		NoDataOnLoad = .T., ;
		Top = 20, ;
		Width = 124
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor2' AS cursor WITH ;
		Alias = "cp_vorden_compra", ;
		CursorSource = "cp_vorden_compra", ;
		Database = ..\data\datos.dbc, ;
		Height = 280, ;
		Left = 150, ;
		Name = "Cursor2", ;
		NoDataOnLoad = .T., ;
		Top = 19, ;
		Width = 133
		*< END OBJECT: BaseClass="cursor" />
	
	PROCEDURE BeforeOpenTables
		SET DELETED ON
	ENDPROC

ENDDEFINE

DEFINE CLASS tsmaintform1 AS tsmovform OF "..\libs\tsbase.vcx" 
 	*< CLASSDATA: Baseclass="form" Timestamp="" Scale="" Uniqueid="" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.txtFecha" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.lblSucursal" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.lblNúmero" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.lblFecha" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.tsgrid1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.tsgrid1.producto.Header1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.tsgrid1.producto.producto" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.tsgrid1.Descripcion.Header1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.tsgrid1.Descripcion.Text1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.tsgrid1.cantidad.Header1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.tsgrid1.cantidad.Text1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.tsgrid1.precio.Header1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.tsgrid1.precio.Text1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.tsgrid1.iva.Header1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.tsgrid1.iva.Text1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.tsgrid1.total.Header1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.tsgrid1.total.Text1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.sucursal" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.Cotizacion" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.Tslabel2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.Tslabel1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.nombre" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.cod_prov" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.Tslabel3" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.fec_env" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.Tslabel4" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.estado" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.Tslabel5" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.Cbomoneda1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.Contacto" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.Tslabel6" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.Tseditbox1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.Tslabel7" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.totales" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.totales.subtotal" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.totales.exento" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.totales.Gravado" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.totales.iva" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.totales.Tslabel6" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.totales.Tslabel1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.totales.Tslabel2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.totales.Tslabel3" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.totales.Tslabel4" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.totales.total" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.Tstextbox1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.Tslabel8" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.Tstextbox2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.Tslabel9" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.Tstextbox3" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.Tslabel10" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.PAGE1.Campo_busca1" UniqueID="" Timestamp="" />

	*<DefinedPropArrayMethod>
		*p: estado_def		&& Estado por defecto
		*p: moneda_def		&& moneda por defecto
		*p: sucursal_def		&& Sucursal por defecto
		*p: valor_iva		&& valor del iva
	*</DefinedPropArrayMethod>

	auditmarcahora = audit_fecha
	auditusuario = audit_usuario
	BorderStyle = 3
	camponro = numero,cp_orden_compra,IdEmpresa=?oApp.Empresa
	camponroorden = S
	campos = idempresa,Idorden
	Caption = "Orden de Compra"
	Comment = "número,cn_Asientos,idempresa = ?oApp.Empresa and ejercicio = ?oApp.Ejercicio"
	detalle = .T.
	DoCreate = .T.
	grupoimpresion = 
	Height = 516
	identidad = idorden
	idobjeto = 
	lallownew = .T.
	Name = "Tsmaintform1"
	tabla1 = cp_vorden_compra
	tabla2 = cp_vdet_ord
	tablaconsulta = OrdenComp
	valores = oApp.Empresa,newid('cp_ord_compra')
	valor_iva = 10		&& valor del iva
	Width = 625
	lblRequerido.Name = "lblRequerido"
	Pageframe1.ErasePage = .T.
	Pageframe1.Height = 516
	Pageframe1.Left = 0
	Pageframe1.Name = "Pageframe1"
	Pageframe1.PAGE1.Name = "PAGE1"
	Pageframe1.PAGE2.grdList.Left = 1
	Pageframe1.PAGE2.grdList.Name = "grdList"
	Pageframe1.PAGE2.grdList.Top = 11
	Pageframe1.PAGE2.Name = "PAGE2"
	Pageframe1.PageCount = 2
	Pageframe1.Top = 0
	Pageframe1.Width = 626

	ADD OBJECT 'Pageframe1.PAGE1.Campo_busca1' AS campo_busca WITH ;
		ControlSource = "cp_vorden_compra.numero", ;
		Height = 22, ;
		Left = 513, ;
		Name = "Campo_busca1", ;
		Top = 22, ;
		Width = 104
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.PAGE1.Cbomoneda1' AS cbomoneda WITH ;
		ControlSource = "cp_vorden_compra.idmoneda", ;
		cursor = Monedas, ;
		Left = 85, ;
		Name = "Cbomoneda1", ;
		origen = R, ;
		TabIndex = 9, ;
		Top = 96, ;
		Width = 202
		*< END OBJECT: ClassLib="..\libs\futura.vcx" BaseClass="combobox" />

	ADD OBJECT 'Pageframe1.PAGE1.cod_prov' AS campo_clave WITH ;
		condicionextra = idempresa = ?oapp.empresa, ;
		condicionvalidacion = !empty(cp_vorden_compra.proveedor), ;
		ControlSource = "cp_vorden_compra.proveedor", ;
		copiarcampos = Contacto, ;
		datoayuda = Proveedores, ;
		Height = 22, ;
		indice = idproveedor, ;
		Left = 85, ;
		mensajeerror = Proveedor no existe, ;
		mensajevalidacion = Ingrese Proveedor, ;
		Name = "cod_prov", ;
		objeto = this.parent.nombre, ;
		origen = R, ;
		pegarcampos = Contacto, ;
		retorna = razon, ;
		solonuevo = .T., ;
		TabIndex = 2, ;
		tabla = cp_proveedor, ;
		Top = 23, ;
		validar = .F., ;
		Width = 82
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.PAGE1.Contacto' AS tstextbox WITH ;
		Comment = "", ;
		ControlSource = "cp_vorden_compra.contacto", ;
		DateFormat = 13, ;
		editable = .T., ;
		Height = 22, ;
		Left = 85, ;
		Name = "Contacto", ;
		TabIndex = 5, ;
		Top = 47, ;
		Width = 322
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.PAGE1.Cotizacion' AS tstextbox WITH ;
		Comment = "", ;
		ControlSource = "cp_vorden_compra.cotizacion", ;
		editable = .T., ;
		Height = 22, ;
		InputMask = "9,999.99", ;
		Left = 85, ;
		Name = "Cotizacion", ;
		TabIndex = 10, ;
		Top = 119, ;
		Width = 99
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.PAGE1.estado' AS tscombobox WITH ;
		BoundColumn = 2, ;
		cmdsql = select descripcion, cod_esta from bs_estados where tipo = 'COMPRA' order by 1, ;
		ControlSource = "cp_vorden_compra.est_ord", ;
		cursor = estados, ;
		Height = 22, ;
		Left = 513, ;
		Name = "estado", ;
		RowSource = "estados.descripcion, cod_esta", ;
		RowSourceType = 6, ;
		TabIndex = 16, ;
		Top = 118, ;
		Width = 104
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="combobox" />

	ADD OBJECT 'Pageframe1.PAGE1.fec_env' AS tstextbox WITH ;
		Comment = "", ;
		ControlSource = "cp_vorden_compra.fec_envio", ;
		DateFormat = 13, ;
		editable = .T., ;
		Height = 22, ;
		Left = 513, ;
		Name = "fec_env", ;
		TabIndex = 14, ;
		Top = 94, ;
		Width = 104
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.PAGE1.lblFecha' AS tslabel WITH ;
		Caption = "Fecha", ;
		Height = 16, ;
		Left = 476, ;
		Name = "lblFecha", ;
		TabIndex = 11, ;
		Top = 70, ;
		Width = 34
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.PAGE1.lblNúmero' AS tslabel WITH ;
		Caption = "Número", ;
		FontBold = .T., ;
		Height = 16, ;
		Left = 464, ;
		Name = "lblNúmero", ;
		TabIndex = 27, ;
		Top = 22, ;
		Width = 46
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.PAGE1.lblSucursal' AS tslabel WITH ;
		Caption = "Sucursal", ;
		Height = 16, ;
		Left = 25, ;
		Name = "lblSucursal", ;
		TabIndex = 6, ;
		Top = 71, ;
		Width = 50
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.PAGE1.nombre' AS tstextbox WITH ;
		Comment = "", ;
		ControlSource = "", ;
		editable = .T., ;
		Height = 22, ;
		Left = 167, ;
		Name = "nombre", ;
		TabIndex = 3, ;
		Top = 23, ;
		Width = 240
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.PAGE1.sucursal' AS tscombobox WITH ;
		BorderStyle = 1, ;
		BoundColumn = 2, ;
		cmdsql = select descripción,ltrim(str(sucursal)) sucursal from sucursal where idempresa = ?oApp.Empresa order by sucursal , ;
		ColumnCount = 2, ;
		ColumnWidths = "125,0", ;
		ControlSource = "cp_vorden_compra.deposito_ent", ;
		cursor = Sucursal, ;
		editable = .T., ;
		FirstElement = 1, ;
		Height = 24, ;
		ItemTips = .T., ;
		Left = 85, ;
		Name = "sucursal", ;
		NumberOfElements = 0, ;
		RowSource = "sucursal.descripción,sucursal", ;
		RowSourceType = 6, ;
		TabIndex = 7, ;
		Top = 71, ;
		Width = 202
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="combobox" />

	ADD OBJECT 'Pageframe1.PAGE1.totales' AS container WITH ;
		Height = 79, ;
		Left = 11, ;
		Name = "totales", ;
		SpecialEffect = 1, ;
		Style = 3, ;
		TabIndex = 29, ;
		Top = 315, ;
		Width = 600, ;
		ZOrderSet = 22
		*< END OBJECT: BaseClass="container" />

	ADD OBJECT 'Pageframe1.PAGE1.totales.exento' AS tstextbox WITH ;
		Alignment = 3, ;
		BackColor = 192,192,192, ;
		ControlSource = "cp_vorden_compra.exenta", ;
		editable = .F., ;
		Enabled = .F., ;
		Height = 22, ;
		InputMask = "999,999,999,999.99", ;
		inputmaskdinamico = , ;
		Left = 274, ;
		Name = "exento", ;
		TabIndex = 3, ;
		Top = 5, ;
		Value = 0, ;
		Width = 117
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.PAGE1.totales.Gravado' AS tstextbox WITH ;
		Alignment = 3, ;
		BackColor = 192,192,192, ;
		ControlSource = "cp_vorden_compra.gravada", ;
		editable = .F., ;
		Enabled = .F., ;
		Height = 22, ;
		InputMask = "999,999,999,999.99", ;
		inputmaskdinamico = , ;
		Left = 274, ;
		Name = "Gravado", ;
		TabIndex = 2, ;
		Top = 29, ;
		Value = 0, ;
		Visible = .T., ;
		Width = 117
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.PAGE1.totales.iva' AS tstextbox WITH ;
		Alignment = 3, ;
		BackColor = 255,255,255, ;
		ControlSource = "cp_vorden_compra.iva", ;
		editable = .F., ;
		Enabled = .F., ;
		Height = 22, ;
		InputMask = "999,999,999.99", ;
		inputmaskdinamico = , ;
		Left = 474, ;
		Name = "iva", ;
		TabIndex = 6, ;
		Top = 28, ;
		Value = 0, ;
		Width = 117
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.PAGE1.totales.subtotal' AS tstextbox WITH ;
		Alignment = 3, ;
		BackColor = 255,255,255, ;
		ControlSource = "", ;
		editable = .F., ;
		Enabled = .F., ;
		Height = 22, ;
		InputMask = "999,999,999,999.99", ;
		inputmaskdinamico = , ;
		Left = 474, ;
		Name = "subtotal", ;
		TabIndex = 4, ;
		Top = 4, ;
		Value = 0, ;
		Width = 117
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.PAGE1.totales.total' AS tstextbox WITH ;
		Alignment = 3, ;
		ControlSource = "", ;
		editable = .F., ;
		Enabled = .F., ;
		Height = 22, ;
		InputMask = "999,999,999,999.99", ;
		inputmaskdinamico = , ;
		Left = 474, ;
		Name = "total", ;
		TabIndex = 7, ;
		Top = 52, ;
		Value = 0, ;
		Width = 117
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.PAGE1.totales.Tslabel1' AS tslabel WITH ;
		Caption = "Exentas", ;
		Height = 16, ;
		Left = 217, ;
		Name = "Tslabel1", ;
		TabIndex = 10, ;
		Top = 8, ;
		Width = 44, ;
		ZOrderSet = 6
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.PAGE1.totales.Tslabel2' AS tslabel WITH ;
		Caption = "IVA", ;
		Height = 16, ;
		Left = 405, ;
		Name = "Tslabel2", ;
		TabIndex = 13, ;
		Top = 29, ;
		Visible = .T., ;
		Width = 58, ;
		ZOrderSet = 6
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.PAGE1.totales.Tslabel3' AS tslabel WITH ;
		Caption = "Sub-Total", ;
		Height = 16, ;
		Left = 395, ;
		Name = "Tslabel3", ;
		TabIndex = 10, ;
		Top = 8, ;
		Width = 68, ;
		ZOrderSet = 6
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.PAGE1.totales.Tslabel4' AS tslabel WITH ;
		Caption = "Total", ;
		Height = 16, ;
		Left = 395, ;
		Name = "Tslabel4", ;
		TabIndex = 10, ;
		Top = 56, ;
		Width = 68, ;
		ZOrderSet = 6
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.PAGE1.totales.Tslabel6' AS tslabel WITH ;
		Caption = "Gravadas", ;
		Height = 16, ;
		Left = 203, ;
		Name = "Tslabel6", ;
		TabIndex = 13, ;
		Top = 29, ;
		Visible = .T., ;
		Width = 58, ;
		ZOrderSet = 6
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.PAGE1.Tseditbox1' AS tseditbox WITH ;
		ControlSource = "cp_vorden_compra.referencia", ;
		editable = .T., ;
		Height = 74, ;
		Left = 11, ;
		Name = "Tseditbox1", ;
		TabIndex = 19, ;
		Top = 404, ;
		Width = 228
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="editbox" />

	ADD OBJECT 'Pageframe1.PAGE1.tsgrid1' AS tsgrid WITH ;
		campo = idorden,idempresa,deposito_ent, ;
		cfieldtosum = iif(cp_vdet_ord.iva=0,cp_vdet_ord.cantidad*cp_vdet_ord.precio,0),iif(cp_vdet_ord.iva<>0,cp_vdet_ord.cantidad*cp_vdet_ord.precio,0),precio*cantidad/ROUND((100+iva)/iva, monedas.decimales), ;
		ColumnCount = 6, ;
		editable = .T., ;
		FontSize = 8, ;
		GridLines = 0, ;
		HeaderHeight = 17, ;
		Height = 168, ;
		Left = 11, ;
		Name = "tsgrid1", ;
		Panel = 1, ;
		RecordMark = .T., ;
		RecordSource = "cp_vdet_ord", ;
		RecordSourceType = 1, ;
		RowHeight = 22, ;
		ScrollBars = 3, ;
		TabIndex = 17, ;
		Top = 143, ;
		valor = cp_vorden_compra.idorden,oApp.Empresa,cp_vorden_compra.deposito_ent, ;
		valorvariable = cp_vorden_compra.idorden, ;
		variablevista = m.idorden, ;
		Width = 600, ;
		Column1.ControlSource = "cp_vdet_ord.idproducto", ;
		Column1.FontSize = 8, ;
		Column1.Name = "producto", ;
		Column1.Width = 58, ;
		Column2.BackColor = 255,255,255, ;
		Column2.ControlSource = "cp_vdet_ord.descripcion", ;
		Column2.FontSize = 8, ;
		Column2.Name = "Descripcion", ;
		Column2.Width = 215, ;
		Column3.ControlSource = "cp_vdet_ord.cantidad", ;
		Column3.FontSize = 8, ;
		Column3.InputMask = "999,999.99", ;
		Column3.Name = "cantidad", ;
		Column3.Width = 75, ;
		Column4.ControlSource = "cp_vdet_ord.precio", ;
		Column4.FontSize = 8, ;
		Column4.InputMask = "999,999,999.99", ;
		Column4.Name = "precio", ;
		Column4.Width = 101, ;
		Column5.ControlSource = "cp_vdet_ord.iva", ;
		Column5.CurrentControl = "Text1", ;
		Column5.FontSize = 8, ;
		Column5.InputMask = "999", ;
		Column5.Name = "iva", ;
		Column5.ReadOnly = .F., ;
		Column5.Width = 31, ;
		Column6.ControlSource = "cp_vdet_ord.cantidad*cp_vdet_ord.precio", ;
		Column6.CurrentControl = "Text1", ;
		Column6.FontSize = 8, ;
		Column6.InputMask = "999,999,999.99", ;
		Column6.Name = "total", ;
		Column6.Width = 114
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="grid" />

	ADD OBJECT 'Pageframe1.PAGE1.tsgrid1.cantidad.Header1' AS header WITH ;
		Alignment = 2, ;
		BackColor = 0,0,128, ;
		Caption = "Cantidad", ;
		FontBold = .T., ;
		FontSize = 8, ;
		ForeColor = 244,244,244, ;
		Name = "Header1"
		*< END OBJECT: BaseClass="header" />

	ADD OBJECT 'Pageframe1.PAGE1.tsgrid1.cantidad.Text1' AS textbox WITH ;
		Alignment = 3, ;
		BackColor = 255,255,255, ;
		BorderStyle = 0, ;
		FontSize = 8, ;
		ForeColor = 0,0,0, ;
		InputMask = "999,999.99", ;
		Margin = 0, ;
		Name = "Text1", ;
		SelectedBackColor = 247,223,187, ;
		SelectedForeColor = 0,64,128
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.PAGE1.tsgrid1.Descripcion.Header1' AS header WITH ;
		Alignment = 2, ;
		BackColor = 0,0,128, ;
		Caption = "Descripción", ;
		FontBold = .T., ;
		FontSize = 8, ;
		ForeColor = 244,244,244, ;
		Name = "Header1"
		*< END OBJECT: BaseClass="header" />

	ADD OBJECT 'Pageframe1.PAGE1.tsgrid1.Descripcion.Text1' AS textbox WITH ;
		BackColor = 255,255,255, ;
		BorderStyle = 0, ;
		DisabledBackColor = 228,228,228, ;
		Enabled = .F., ;
		FontSize = 8, ;
		ForeColor = 0,0,0, ;
		Margin = 0, ;
		Name = "Text1", ;
		SelectedBackColor = 247,223,187, ;
		SelectedForeColor = 0,64,128
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.PAGE1.tsgrid1.iva.Header1' AS header WITH ;
		Alignment = 2, ;
		BackColor = 0,0,128, ;
		Caption = "IVA", ;
		FontBold = .T., ;
		FontSize = 8, ;
		ForeColor = 244,244,244, ;
		Name = "Header1", ;
		WordWrap = .T.
		*< END OBJECT: BaseClass="header" />

	ADD OBJECT 'Pageframe1.PAGE1.tsgrid1.iva.Text1' AS textbox WITH ;
		Alignment = 3, ;
		ControlSource = "cp_vdet_ord.iva", ;
		FontSize = 8, ;
		Height = 23, ;
		InputMask = "999", ;
		Left = 24, ;
		Name = "Text1", ;
		ReadOnly = .F., ;
		SelectedBackColor = 247,223,187, ;
		SelectedForeColor = 0,64,128, ;
		Top = 35, ;
		Width = 100
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.PAGE1.tsgrid1.precio.Header1' AS header WITH ;
		Alignment = 2, ;
		BackColor = 0,0,128, ;
		Caption = "Precio", ;
		FontBold = .T., ;
		FontSize = 8, ;
		ForeColor = 244,244,244, ;
		Name = "Header1"
		*< END OBJECT: BaseClass="header" />

	ADD OBJECT 'Pageframe1.PAGE1.tsgrid1.precio.Text1' AS textbox WITH ;
		Alignment = 3, ;
		BackColor = 255,255,255, ;
		BorderStyle = 0, ;
		FontSize = 8, ;
		ForeColor = 0,0,0, ;
		InputMask = "999,999,999.99", ;
		Margin = 0, ;
		Name = "Text1", ;
		SelectedBackColor = 247,223,187, ;
		SelectedForeColor = 0,64,128
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.PAGE1.tsgrid1.producto.Header1' AS header WITH ;
		Alignment = 2, ;
		BackColor = 0,0,128, ;
		Caption = "Producto", ;
		FontBold = .T., ;
		FontSize = 8, ;
		ForeColor = 244,244,244, ;
		Name = "Header1"
		*< END OBJECT: BaseClass="header" />

	ADD OBJECT 'Pageframe1.PAGE1.tsgrid1.producto.producto' AS campo_clave WITH ;
		actualizar = .F., ;
		BackStyle = 0, ;
		BorderStyle = 0, ;
		condicionextra = a.iva = b.iva and a.IdEmpresa=?oApp.Empresa, ;
		ControlSource = "cp_vdet_ord.idproducto", ;
		datoayuda = Productos, ;
		indice = idproducto, ;
		indice1 = catalogo, ;
		Left = 359, ;
		mensajeerror = El codigo de poroducto no existe, ;
		Name = "producto", ;
		objeto = this.parent.parent.descripcion.text1, ;
		objeto2 = this.parent.parent.iva.text1, ;
		objeto3 = , ;
		objeto4 = , ;
		origen = R, ;
		retorna = a.descripcion, ;
		retorna2 = isnull(b.valor,0), ;
		retorna3 = , ;
		retorna4 = , ;
		SelectedBackColor = 247,223,187, ;
		SelectedForeColor = 0,64,128, ;
		SpecialEffect = 1, ;
		tabla = st_producto a,   vt_iva b, ;
		Top = 46
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.PAGE1.tsgrid1.total.Header1' AS header WITH ;
		Alignment = 2, ;
		BackColor = 0,0,128, ;
		Caption = "Total", ;
		FontBold = .T., ;
		FontSize = 8, ;
		ForeColor = 244,244,244, ;
		Name = "Header1"
		*< END OBJECT: BaseClass="header" />

	ADD OBJECT 'Pageframe1.PAGE1.tsgrid1.total.Text1' AS textbox WITH ;
		FontSize = 8, ;
		Height = 23, ;
		InputMask = "999,999,999.99", ;
		Left = 76, ;
		Name = "Text1", ;
		SelectedBackColor = 247,223,187, ;
		SelectedForeColor = 0,64,128, ;
		Top = 35, ;
		Width = 100
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.PAGE1.Tslabel1' AS tslabel WITH ;
		Caption = "Moneda", ;
		Height = 16, ;
		Left = 25, ;
		Name = "Tslabel1", ;
		TabIndex = 8, ;
		Top = 95, ;
		Width = 50
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.PAGE1.Tslabel10' AS tslabel WITH ;
		Caption = "Telefono", ;
		Height = 16, ;
		Left = 239, ;
		Name = "Tslabel10", ;
		TabIndex = 24, ;
		Top = 454, ;
		Width = 93
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.PAGE1.Tslabel2' AS tslabel WITH ;
		Caption = "Cotización", ;
		Height = 16, ;
		Left = -90, ;
		Name = "Tslabel2", ;
		TabIndex = 26, ;
		Top = 119, ;
		Width = 165
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.PAGE1.Tslabel3' AS tslabel WITH ;
		Caption = "Proveedor", ;
		Height = 16, ;
		Left = 13, ;
		Name = "Tslabel3", ;
		TabIndex = 1, ;
		Top = 23, ;
		Width = 62
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.PAGE1.Tslabel4' AS tslabel WITH ;
		Caption = "Fecha Envio", ;
		Height = 16, ;
		Left = 440, ;
		Name = "Tslabel4", ;
		TabIndex = 13, ;
		Top = 94, ;
		Width = 70
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.PAGE1.Tslabel5' AS tslabel WITH ;
		Caption = "Estado", ;
		Height = 16, ;
		Left = 440, ;
		Name = "Tslabel5", ;
		TabIndex = 15, ;
		Top = 118, ;
		Width = 70
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.PAGE1.Tslabel6' AS tslabel WITH ;
		Caption = "Contacto", ;
		Height = 16, ;
		Left = 12, ;
		Name = "Tslabel6", ;
		TabIndex = 4, ;
		Top = 47, ;
		Width = 70
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.PAGE1.Tslabel7' AS tslabel WITH ;
		Caption = "Obs.", ;
		Height = 16, ;
		Left = 14, ;
		Name = "Tslabel7", ;
		TabIndex = 18, ;
		Top = 392, ;
		Width = 24
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.PAGE1.Tslabel8' AS tslabel WITH ;
		Caption = "Direccion Envio", ;
		Height = 16, ;
		Left = 239, ;
		Name = "Tslabel8", ;
		TabIndex = 20, ;
		Top = 406, ;
		Width = 93
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.PAGE1.Tslabel9' AS tslabel WITH ;
		Caption = "Ciudad", ;
		Height = 16, ;
		Left = 239, ;
		Name = "Tslabel9", ;
		TabIndex = 22, ;
		Top = 430, ;
		Width = 93
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.PAGE1.Tstextbox1' AS tstextbox WITH ;
		Comment = "", ;
		ControlSource = "cp_vorden_compra.direccionenvio", ;
		DateFormat = 13, ;
		editable = .T., ;
		Height = 22, ;
		Left = 335, ;
		Name = "Tstextbox1", ;
		TabIndex = 21, ;
		Top = 406, ;
		Width = 276
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.PAGE1.Tstextbox2' AS tstextbox WITH ;
		Comment = "", ;
		ControlSource = "cp_vorden_compra.ciudadenvio", ;
		DateFormat = 13, ;
		editable = .T., ;
		Height = 22, ;
		Left = 335, ;
		Name = "Tstextbox2", ;
		TabIndex = 23, ;
		Top = 430, ;
		Width = 276
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.PAGE1.Tstextbox3' AS tstextbox WITH ;
		Comment = "", ;
		ControlSource = "cp_vorden_compra.telefonoenvio", ;
		DateFormat = 13, ;
		editable = .T., ;
		Height = 22, ;
		Left = 335, ;
		Name = "Tstextbox3", ;
		TabIndex = 25, ;
		Top = 454, ;
		Width = 276
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.PAGE1.txtFecha' AS tstextbox WITH ;
		Comment = "", ;
		ControlSource = "cp_vorden_compra.fec_ord", ;
		DateFormat = 13, ;
		editable = .T., ;
		Height = 22, ;
		Left = 513, ;
		Name = "txtFecha", ;
		TabIndex = 12, ;
		Top = 70, ;
		Width = 104
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />
	
	PROCEDURE addnew
		DODEFAULT()
		THIS.PAGEFRAME1.PAGE1.TXTFECHA.VALUE = DATE()
		THIS.PAGEFRAME1.PAGE1.ESTADO.VALUE = 'I'
		THIS.PAGEFRAME1.PAGE1.SUCURSAL.LISTINDEX = 1
		THIS.PAGEFRAME1.PAGE1.CBOMONEDA1.LISTINDEX = 1
		THIS.PAGEFRAME1.PAGE1.COTIZACION.VALUE = COTIZACION(THIS.PAGEFRAME1.PAGE1.CBOMONEDA1.VALUE, 'V', THIS.PAGEFRAME1.PAGE1.TXTFECHA.VALUE)
	ENDPROC

	PROCEDURE imprimir
		LOCAL M.OPCION
		DO FORM sys_opcionimpresion TO M.OPCION
		M.IDORDEN = CP_VORDEN_COMPRA.IDORDEN
		lcReport= "cp_ORdenCompra" + oApp.Empresa + '.frx'
		IF !FILE(lcReport) 
		lcReport= "cp_ORdenCompra" 
		ENDIF
		
		DO CASE
		CASE M.OPCION=1
		REPORT FORM (lcReport) TO PRINTER PROMPT NODIALOG PREVIEW
		CASE M.OPCION=2
		REPORT FORM (lcReport) TO PRINTER PROMPT NOCONSOLE
		ENDCASE
	ENDPROC

	PROCEDURE Init
		DODEFAULT()
		LOCAL STRSQL
		STRSQL = "Select valor from bs_constante where constante = "+"'"+"MONEDA_COMPRA"+"'"+"AND idempresa = "+"'"+OAPP.EMPRESA+"'"
		IF SQL(STRSQL, 'moneda_def')>0
		THIS.MONEDA_DEF = MONEDA_DEF.VALOR
		ENDIF
	ENDPROC

	PROCEDURE Pageframe1.PAGE1.totales.exento.GotFocus
		THIS.TAG = STR(THIS.VALUE)
	ENDPROC

	PROCEDURE Pageframe1.PAGE1.totales.exento.LostFocus
		IF THIS.TAG<>STR(THIS.VALUE)
		THIS.PARENT.REFRESH()
		ENDIF
	ENDPROC

	PROCEDURE Pageframe1.PAGE1.totales.Gravado.GotFocus
		THIS.TAG = STR(THIS.VALUE)
	ENDPROC

	PROCEDURE Pageframe1.PAGE1.totales.Gravado.LostFocus
		IF THIS.TAG<>STR(THIS.VALUE)
		THIS.PARENT.REFRESH()
		ENDIF
	ENDPROC

	PROCEDURE Pageframe1.PAGE1.totales.Refresh
		LOCAL LNTOTAL, LNDESCUENTO, LNPORCDESCUENTO
		IF THISFORM.EDITMODE
			THIS.PARENT.TSGRID1.SUMCOLUMN()
			IF THIS.PARENT.TSGRID1.TOTALES(1)>0
				THIS.EXENTO.VALUE = THIS.PARENT.TSGRID1.TOTALES(1)
			ELSE
				THIS.EXENTO.VALUE = 0
			ENDIF
			IF THIS.PARENT.TSGRID1.TOTALES(2)>0
				THIS.GRAVADO.VALUE = THIS.PARENT.TSGRID1.TOTALES(2)
				THIS.IVA.VALUE = THIS.PARENT.TSGRID1.TOTALES(3)
			ELSE
				THIS.GRAVADO.VALUE = 0
				THIS.IVA.VALUE = 0
			ENDIF
		ENDIF
		THIS.SUBTOTAL.VALUE = CP_VORDEN_COMPRA.EXENTA+CP_VORDEN_COMPRA.GRAVADA
		THIS.TOTAL.VALUE = CP_VORDEN_COMPRA.EXENTA+CP_VORDEN_COMPRA.GRAVADA
	ENDPROC

	PROCEDURE Pageframe1.PAGE1.tsgrid1.cantidad.Text1.GotFocus
		THIS.TAG = STR(THIS.VALUE)
	ENDPROC

	PROCEDURE Pageframe1.PAGE1.tsgrid1.cantidad.Text1.LostFocus
		IF THIS.TAG<>STR(THIS.VALUE)
		THIS.PARENT.PARENT.PARENT.TOTALES.REFRESH()
		ENDIF
	ENDPROC

	PROCEDURE Pageframe1.PAGE1.tsgrid1.Descripcion.Text1.When
		LOCAL COD_PROD, STRSQL
		COD_PROD = CP_VDET_ORD.IDPRODUCTO
		STRSQL = "select idtipo from st_producto "+" where idproducto = "+"'"+COD_PROD+"'"
		IF SQL(STRSQL, 't_prod')>0
		IF T_PROD.IDTIPO="G"
		RETURN .T.
		ELSE
		RETURN .F.
		ENDIF
		ELSE
		RETURN .F.
		ENDIF
	ENDPROC

	PROCEDURE Pageframe1.PAGE1.tsgrid1.iva.Text1.GotFocus
		THIS.TAG = STR(THIS.VALUE)
	ENDPROC

	PROCEDURE Pageframe1.PAGE1.tsgrid1.iva.Text1.LostFocus
		IF THIS.TAG<>STR(THIS.VALUE)
		THIS.PARENT.PARENT.PARENT.TOTALES.REFRESH()
		ENDIF
	ENDPROC

	PROCEDURE Pageframe1.PAGE1.tsgrid1.precio.Text1.GotFocus
		THIS.TAG = STR(THIS.VALUE)
	ENDPROC

	PROCEDURE Pageframe1.PAGE1.tsgrid1.precio.Text1.LostFocus
		IF THIS.TAG<>STR(THIS.VALUE)
		THIS.PARENT.PARENT.PARENT.TOTALES.REFRESH()
		ENDIF
	ENDPROC

	PROCEDURE Pageframe1.PAGE1.tsgrid1.Refresh
		DODEFAULT()
		THIS.TOTAL.ENABLED = .F.
		THIS.PARENT.TOTALES.REFRESH()
	ENDPROC

	PROCEDURE Pageframe1.PAGE1.txtFecha.GotFocus
		THIS.TAG = DTOC(THIS.VALUE)
	ENDPROC

	PROCEDURE Pageframe1.PAGE1.txtFecha.LostFocus
		IF THIS.TAG<>DTOC(THIS.VALUE)
		THIS.PARENT.COTIZACION.VALUE = COTIZACION(THIS.PARENT.CBOMONEDA1.VALUE, 'V', THIS.VALUE)
		ENDIF
	ENDPROC

ENDDEFINE
