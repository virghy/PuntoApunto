*--------------------------------------------------------------------------------------------------------------------------------------------------------
* (ES) AUTOGENERADO - ¡¡ATENCIÓN!! - ¡¡NO PENSADO PARA EJECUTAR!! USAR SOLAMENTE PARA INTEGRAR CAMBIOS Y ALMACENAR CON HERRAMIENTAS SCM!!
* (EN) AUTOGENERATED - ATTENTION!! - NOT INTENDED FOR EXECUTION!! USE ONLY FOR MERGING CHANGES AND STORING WITH SCM TOOLS!!
*--------------------------------------------------------------------------------------------------------------------------------------------------------
*< FOXBIN2PRG: Version="1.19" SourceFile="st_inventario.scx" /> (Solo para binarios VFP 9 / Only for VFP 9 binaries)
*
*
#INCLUDE "..\include\tastrade.h"

DEFINE CLASS dataenvironment AS dataenvironment 
 	*< CLASSDATA: Baseclass="dataenvironment" Timestamp="" Scale="" Uniqueid="" ClassIcon="2" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Cursor1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor3" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor4" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor5" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor6" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor7" UniqueID="" Timestamp="" />

	DataSource = .NULL.
	Height = 480
	InitialSelectedAlias = "st_inventario"
	Left = 289
	Name = "Dataenvironment"
	Top = 101
	Width = 596

	ADD OBJECT 'Cursor1' AS cursor WITH ;
		Alias = "st_movimiento", ;
		CursorSource = "st_movimiento", ;
		Database = ..\data\datos.dbc, ;
		Height = 90, ;
		Left = 10, ;
		Name = "Cursor1", ;
		NoDataOnLoad = .T., ;
		Top = 19, ;
		Width = 112
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor2' AS cursor WITH ;
		Alias = "st_inventario", ;
		CursorSource = "st_inventario", ;
		Database = ..\data\datos.dbc, ;
		Height = 150, ;
		Left = 150, ;
		Name = "Cursor2", ;
		NoDataOnLoad = .T., ;
		Top = 20, ;
		Width = 115
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor3' AS cursor WITH ;
		Alias = "st_inventariodet", ;
		BufferModeOverride = 5, ;
		CursorSource = "st_inventariodet", ;
		Database = ..\data\datos.dbc, ;
		Height = 149, ;
		Left = 290, ;
		Name = "Cursor3", ;
		NoDataOnLoad = .T., ;
		Top = 19, ;
		Width = 116
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor4' AS cursor WITH ;
		Alias = "st_detfactu", ;
		BufferModeOverride = 5, ;
		CursorSource = "st_detfactu", ;
		Database = ..\data\datos.dbc, ;
		Height = 252, ;
		Left = 429, ;
		Name = "Cursor4", ;
		NoDataOnLoad = .T., ;
		Top = 1, ;
		Width = 135
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor5' AS cursor WITH ;
		Alias = "st_deposito", ;
		CursorSource = "st_deposito", ;
		Database = ..\data\datos.dbc, ;
		Height = 186, ;
		Left = 10, ;
		Name = "Cursor5", ;
		NoDataOnLoad = .T., ;
		Top = 140, ;
		Width = 124
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor6' AS cursor WITH ;
		Alias = "st_cpbt_stk", ;
		CursorSource = "st_cpbt_stk", ;
		Database = ..\data\datos.dbc, ;
		Height = 219, ;
		Left = 180, ;
		Name = "Cursor6", ;
		NoDataOnLoad = .T., ;
		Top = 194, ;
		Width = 152
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor7' AS cursor WITH ;
		Alias = "bs_monedas", ;
		CursorSource = "bs_monedas", ;
		Database = ..\data\datos.dbc, ;
		Height = 94, ;
		Left = 391, ;
		Name = "Cursor7", ;
		NoDataOnLoad = .T., ;
		Top = 327, ;
		Width = 113
		*< END OBJECT: BaseClass="cursor" />
	
	PROCEDURE BeforeOpenTables
		DO seteo
	ENDPROC

ENDDEFINE

DEFINE CLASS st_movimientos AS tsmaintform OF "..\libs\tsbase.vcx" 
 	*< CLASSDATA: Baseclass="form" Timestamp="" Scale="" Uniqueid="" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tslabel4" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.txtFecfactu" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Referencia" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.fechafac" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tslabel1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.totales" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.totales.TotalCheque" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.totales.Tslabel7" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.totales.txtResultado" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.totales.Tslabel1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.totales.txtFaltante" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.totales.Tslabel2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.totales.txtSobrante" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.totales.Tslabel3" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.idinventario" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.lblIdfactura" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tsfact1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tsfact1.IdProducto.Header1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tsfact1.IdProducto.Idproducto1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tsfact1.Producto.Header1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tsfact1.Producto.Text1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tsfact1.Cantidad.Header1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tsfact1.Cantidad.txtCantidad" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tsfact1.Inventario.Header1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tsfact1.Inventario.Text1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tsfact1.Faltante.Header1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tsfact1.Faltante.Text1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tsfact1.Sobrante.Header1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tsfact1.Sobrante.Text1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tsfact1.Importe.Header1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tsfact1.Importe.Text1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tscommandbutton1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tscommandbutton2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.chkCerrado" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.dep_entrada" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tslabel2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.listaprecio" UniqueID="" Timestamp="" />

	BufferMode = 0
	camponro = Nro,st_Inventario, Idempresa=?oApp.Empresa
	campos = IdEmpresa,IdInventario
	campotam = 
	Caption = "Toma de Inventario"
	DataSession = 2
	detalle = .T.
	DoCreate = .T.
	editmode = .F.
	etiquetamenu = Compras
	Height = 530
	LockScreen = .F.
	Name = "st_Movimientos"
	tabla1 = st_Inventario
	tabla2 = st_InventarioDet
	tabla3 = st_movimiento
	tabla4 = st_detfactu
	valores = oApp.Empresa,NEWID('ST_INVENTARIO')
	WhatsThisButton = .T.
	Width = 779
	WindowState = 0
	lblRequerido.Name = "lblRequerido"
	Pageframe1.ErasePage = .T.
	Pageframe1.Height = 530
	Pageframe1.Left = 1
	Pageframe1.Name = "Pageframe1"
	Pageframe1.Page1.Name = "Page1"
	Pageframe1.Page2.grdList.Name = "grdList"
	Pageframe1.Page2.Name = "Page2"
	Pageframe1.Top = 1
	Pageframe1.Width = 779

	ADD OBJECT 'Pageframe1.Page1.chkCerrado' AS tscheckbox WITH ;
		Alignment = 0, ;
		Caption = "Cerrado", ;
		Comment = "", ;
		ControlSource = "st_inventario.cerrado", ;
		Height = 16, ;
		Left = 396, ;
		Name = "chkCerrado", ;
		Top = 39, ;
		Width = 57
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="checkbox" />

	ADD OBJECT 'Pageframe1.Page1.dep_entrada' AS cbodeposito WITH ;
		ControlSource = "st_inventario.iddeposito", ;
		Left = 106, ;
		Name = "dep_entrada", ;
		Top = 34
		*< END OBJECT: ClassLib="..\libs\futura.vcx" BaseClass="combobox" />

	ADD OBJECT 'Pageframe1.Page1.fechafac' AS tslabel WITH ;
		Alignment = 1, ;
		Caption = "Fecha:", ;
		FontBold = .F., ;
		Height = 16, ;
		Left = 40, ;
		Name = "fechafac", ;
		TabIndex = 3, ;
		Top = 10, ;
		Width = 64, ;
		ZOrderSet = 4
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page1.idinventario' AS tstextbox WITH ;
		ControlSource = "st_inventario.nro", ;
		editable = .T., ;
		Enabled = .T., ;
		Height = 23, ;
		InputMask = "", ;
		Left = 106, ;
		Name = "idinventario", ;
		TabIndex = 18, ;
		Top = 58, ;
		Visible = .T., ;
		Width = 86, ;
		ZOrderSet = 20
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page1.lblIdfactura' AS tslabel WITH ;
		Alignment = 1, ;
		AutoSize = .F., ;
		Caption = "Nro.:", ;
		FontBold = .F., ;
		Height = 12, ;
		Left = 79, ;
		Name = "lblIdfactura", ;
		TabIndex = 17, ;
		Top = 58, ;
		Visible = .T., ;
		Width = 25, ;
		ZOrderSet = 7
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page1.listaprecio' AS cbolistaprecio WITH ;
		ControlSource = "st_inventario.idlista", ;
		Left = 396, ;
		Name = "listaprecio", ;
		Top = 9
		*< END OBJECT: ClassLib="..\libs\futura.vcx" BaseClass="combobox" />

	ADD OBJECT 'Pageframe1.Page1.Referencia' AS tstextbox WITH ;
		Comment = "", ;
		ControlSource = "st_inventario.obs", ;
		DateFormat = 13, ;
		editable = .T., ;
		Format = "K", ;
		Height = 23, ;
		Left = 106, ;
		Name = "Referencia", ;
		TabIndex = 14, ;
		Top = 82, ;
		Width = 648, ;
		ZOrderSet = 3
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page1.totales' AS container WITH ;
		Height = 67, ;
		Left = 10, ;
		Name = "totales", ;
		SpecialEffect = 1, ;
		TabIndex = 16, ;
		Top = 430, ;
		Width = 744, ;
		ZOrderSet = 22
		*< END OBJECT: BaseClass="container" />

	ADD OBJECT 'Pageframe1.Page1.totales.TotalCheque' AS tstextbox WITH ;
		Alignment = 3, ;
		BackColor = 192,192,192, ;
		ControlSource = "", ;
		Enabled = .F., ;
		Height = 24, ;
		InputMask = "999,999,999,999", ;
		Left = 324, ;
		Name = "TotalCheque", ;
		TabIndex = 2, ;
		Top = 12, ;
		Value = 0, ;
		Width = 92
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page1.totales.Tslabel1' AS tslabel WITH ;
		BackColor = 0,0,0, ;
		Caption = "Faltante", ;
		Height = 12, ;
		Left = 428, ;
		Name = "Tslabel1", ;
		TabIndex = 8, ;
		Top = 17, ;
		Width = 47
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page1.totales.Tslabel2' AS tslabel WITH ;
		BackColor = 0,0,0, ;
		Caption = "Resultado", ;
		Height = 12, ;
		Left = 572, ;
		Name = "Tslabel2", ;
		TabIndex = 8, ;
		Top = 15, ;
		Width = 58
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page1.totales.Tslabel3' AS tslabel WITH ;
		BackColor = 0,0,0, ;
		Caption = "Sobrante", ;
		Height = 12, ;
		Left = 421, ;
		Name = "Tslabel3", ;
		TabIndex = 8, ;
		Top = 39, ;
		Width = 54
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page1.totales.Tslabel7' AS tslabel WITH ;
		BackColor = 0,0,0, ;
		Caption = "Total", ;
		Height = 12, ;
		Left = 271, ;
		Name = "Tslabel7", ;
		TabIndex = 8, ;
		Top = 17, ;
		Width = 47
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page1.totales.txtFaltante' AS tstextbox WITH ;
		Alignment = 3, ;
		BackColor = 192,192,192, ;
		ControlSource = "", ;
		Enabled = .F., ;
		Height = 24, ;
		InputMask = "999,999,999,999", ;
		Left = 478, ;
		Name = "txtFaltante", ;
		TabIndex = 2, ;
		Top = 12, ;
		Value = 0, ;
		Width = 92
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page1.totales.txtResultado' AS tstextbox WITH ;
		Alignment = 3, ;
		BackColor = 192,192,192, ;
		ControlSource = "", ;
		Enabled = .F., ;
		FontBold = .T., ;
		Height = 24, ;
		InputMask = "999,999,999,999", ;
		Left = 633, ;
		Name = "txtResultado", ;
		TabIndex = 2, ;
		Top = 12, ;
		Value = 0, ;
		Width = 89
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page1.totales.txtSobrante' AS tstextbox WITH ;
		Alignment = 3, ;
		BackColor = 192,192,192, ;
		ControlSource = "", ;
		Enabled = .F., ;
		Height = 24, ;
		InputMask = "999,999,999,999", ;
		Left = 478, ;
		Name = "txtSobrante", ;
		TabIndex = 2, ;
		Top = 36, ;
		Value = 0, ;
		Width = 92
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page1.Tscommandbutton1' AS tscommandbutton WITH ;
		Caption = "Cerrar Inventario", ;
		FontBold = .F., ;
		Height = 24, ;
		Left = 574, ;
		Name = "Tscommandbutton1", ;
		Top = 46, ;
		Width = 180
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'Pageframe1.Page1.Tscommandbutton2' AS tscommandbutton WITH ;
		Caption = "Generar Inventario", ;
		FontBold = .F., ;
		Height = 24, ;
		Left = 574, ;
		Name = "Tscommandbutton2", ;
		Top = 22, ;
		Width = 180
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'Pageframe1.Page1.Tsfact1' AS tsgrid WITH ;
		AllowAddNew = .F., ;
		AllowHeaderSizing = .F., ;
		AllowRowSizing = .F., ;
		campo = IdEmpresa,IdInventario, ;
		cfieldtosum = Cantidad, IIF(Resultado < 0, ABS(importe), 0) , IIF(Resultado > 0, ABS(importe), 0), Importe, ;
		ChildOrder = "", ;
		codigo = IdProducto, ;
		ColumnCount = 7, ;
		DeleteMark = .F., ;
		editable = .T., ;
		FontShadow = .F., ;
		FontSize = 8, ;
		GridLines = 2, ;
		HeaderHeight = 17, ;
		Height = 309, ;
		Highlight = .F., ;
		Left = 8, ;
		LinkMaster = "", ;
		Name = "Tsfact1", ;
		Panel = 1, ;
		PanelLink = .T., ;
		RecordMark = .F., ;
		RecordSource = "st_inventariodet", ;
		RelationalExpr = "", ;
		RightToLeft = .T., ;
		RowHeight = 17, ;
		ScrollBars = 2, ;
		SplitBar = .F., ;
		TabIndex = 15, ;
		Top = 109, ;
		valor = oApp.Empresa,st_Inventario.IdInventario, ;
		valorvariable = st_Inventario.IdInventario, ;
		variablevista = m.IdInventario, ;
		Width = 746, ;
		ZOrderSet = 19, ;
		Column1.ColumnOrder = 1, ;
		Column1.ControlSource = "st_inventariodet.idproducto", ;
		Column1.CurrentControl = "Idproducto1", ;
		Column1.FontShadow = .F., ;
		Column1.FontSize = 8, ;
		Column1.Name = "IdProducto", ;
		Column1.Sparse = .F., ;
		Column1.Visible = .T., ;
		Column1.Width = 79, ;
		Column2.BackColor = 211,224,231, ;
		Column2.ControlSource = "st_inventariodet.descripcion", ;
		Column2.Enabled = .F., ;
		Column2.FontShadow = .F., ;
		Column2.FontSize = 8, ;
		Column2.Name = "Producto", ;
		Column2.ReadOnly = .T., ;
		Column2.Visible = .T., ;
		Column2.Width = 264, ;
		Column3.ControlSource = "st_inventariodet.cantidad", ;
		Column3.DynamicInputMask = "'999,999,999'+iif(oApp.Producto_decimal=0,'','.'+replicate('9',oApp.Producto_decimal))", ;
		Column3.FontShadow = .F., ;
		Column3.FontSize = 8, ;
		Column3.Name = "Cantidad", ;
		Column3.ReadOnly = .T., ;
		Column3.Visible = .T., ;
		Column3.Width = 73, ;
		Column4.ControlSource = "st_inventariodet.inventario", ;
		Column4.DynamicInputMask = "'999,999,999'+iif(oApp.Producto_decimal=0,'','.'+replicate('9',oApp.Producto_decimal))", ;
		Column4.FontShadow = .F., ;
		Column4.FontSize = 8, ;
		Column4.Format = "Z", ;
		Column4.InputMask = "", ;
		Column4.Name = "Inventario", ;
		Column4.Visible = .T., ;
		Column4.Width = 74, ;
		Column5.ControlSource = "iif(Resultado < 0, abs(Resultado),0)", ;
		Column5.DynamicInputMask = "'999,999,999'+iif(oApp.Producto_decimal=0,'','.'+replicate('9',oApp.Producto_decimal))", ;
		Column5.FontShadow = .F., ;
		Column5.FontSize = 8, ;
		Column5.Format = "Z", ;
		Column5.Name = "Faltante", ;
		Column5.ReadOnly = .T., ;
		Column5.Width = 77, ;
		Column6.ControlSource = "iif(Resultado > 0, Resultado,0)", ;
		Column6.DynamicInputMask = "'999,999,999'+iif(oApp.Producto_decimal=0,'','.'+replicate('9',oApp.Producto_decimal))", ;
		Column6.FontShadow = .F., ;
		Column6.FontSize = 8, ;
		Column6.Format = "Z", ;
		Column6.Name = "Sobrante", ;
		Column6.ReadOnly = .T., ;
		Column6.Width = 78, ;
		Column7.ControlSource = "importe*resultado", ;
		Column7.FontShadow = .F., ;
		Column7.FontSize = 8, ;
		Column7.InputMask = "999,999,999", ;
		Column7.Name = "Importe", ;
		Column7.ReadOnly = .T., ;
		Column7.Width = 71
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="grid" />

	ADD OBJECT 'Pageframe1.Page1.Tsfact1.Cantidad.Header1' AS header WITH ;
		Caption = "Cantidad", ;
		FontShadow = .F., ;
		FontSize = 8, ;
		Name = "Header1"
		*< END OBJECT: BaseClass="header" />

	ADD OBJECT 'Pageframe1.Page1.Tsfact1.Cantidad.txtCantidad' AS tstextbox WITH ;
		BorderStyle = 0, ;
		camposec = , ;
		ControlSource = "st_detfactu.cantidad", ;
		editable = .F., ;
		Enabled = .F., ;
		FontSize = 8, ;
		Height = 23, ;
		InputMask = "", ;
		inputmaskdinamico = '999,999,999'+iif(oApp.Producto_decimal=0,'','.'+replicate('9',oApp.Producto_decimal)), ;
		Left = 370, ;
		Name = "txtCantidad", ;
		ReadOnly = .T., ;
		SelectedBackColor = 247,223,187, ;
		SelectedForeColor = 0,64,128, ;
		TabIndex = 4, ;
		Top = 8, ;
		Visible = .T., ;
		Width = 86, ;
		ZOrderSet = 20
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page1.Tsfact1.Faltante.Header1' AS header WITH ;
		Caption = "Faltante", ;
		FontSize = 8, ;
		Name = "Header1"
		*< END OBJECT: BaseClass="header" />

	ADD OBJECT 'Pageframe1.Page1.Tsfact1.Faltante.Text1' AS textbox WITH ;
		BackColor = 255,255,255, ;
		BorderStyle = 0, ;
		FontSize = 8, ;
		ForeColor = 0,0,0, ;
		Margin = 0, ;
		Name = "Text1", ;
		ReadOnly = .T., ;
		SelectedBackColor = 247,223,187, ;
		SelectedForeColor = 0,64,128
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page1.Tsfact1.IdProducto.Header1' AS header WITH ;
		Caption = "Producto", ;
		FontShadow = .F., ;
		FontSize = 8, ;
		Name = "Header1"
		*< END OBJECT: BaseClass="header" />

	ADD OBJECT 'Pageframe1.Page1.Tsfact1.IdProducto.Idproducto1' AS idproducto WITH ;
		Left = 286, ;
		Name = "Idproducto1", ;
		objeto = this.parent.parent.producto.Text1, ;
		SelectedBackColor = 247,223,187, ;
		SelectedForeColor = 0,64,128, ;
		Top = 36
		*< END OBJECT: ClassLib="..\libs\futura.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page1.Tsfact1.Importe.Header1' AS header WITH ;
		Caption = "Importe", ;
		FontSize = 8, ;
		Name = "Header1"
		*< END OBJECT: BaseClass="header" />

	ADD OBJECT 'Pageframe1.Page1.Tsfact1.Importe.Text1' AS textbox WITH ;
		BackColor = 255,255,255, ;
		BorderStyle = 0, ;
		ControlSource = "st_inventariodet.importe", ;
		FontSize = 8, ;
		ForeColor = 0,0,0, ;
		InputMask = "999,999,999", ;
		Margin = 0, ;
		Name = "Text1", ;
		ReadOnly = .T., ;
		SelectedBackColor = 247,223,187, ;
		SelectedForeColor = 0,64,128
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page1.Tsfact1.Inventario.Header1' AS header WITH ;
		Caption = "Inventario", ;
		FontShadow = .F., ;
		FontSize = 8, ;
		Name = "Header1"
		*< END OBJECT: BaseClass="header" />

	ADD OBJECT 'Pageframe1.Page1.Tsfact1.Inventario.Text1' AS textbox WITH ;
		BackColor = 255,255,255, ;
		BorderStyle = 0, ;
		ControlSource = "", ;
		FontShadow = .F., ;
		FontSize = 8, ;
		ForeColor = 0,0,0, ;
		Margin = 0, ;
		Name = "Text1", ;
		SelectedBackColor = 247,223,187, ;
		SelectedForeColor = 0,64,128, ;
		Visible = .T.
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page1.Tsfact1.Producto.Header1' AS header WITH ;
		Caption = "Descripción", ;
		FontShadow = .F., ;
		FontSize = 8, ;
		Name = "Header1"
		*< END OBJECT: BaseClass="header" />

	ADD OBJECT 'Pageframe1.Page1.Tsfact1.Producto.Text1' AS textbox WITH ;
		BackColor = 211,224,231, ;
		BorderStyle = 0, ;
		ControlSource = "st_detfactu.nomproducto", ;
		Enabled = .F., ;
		FontShadow = .F., ;
		FontSize = 8, ;
		ForeColor = 0,0,0, ;
		Margin = 0, ;
		Name = "Text1", ;
		ReadOnly = .T., ;
		SelectedBackColor = 247,223,187, ;
		SelectedForeColor = 0,64,128, ;
		Visible = .T.
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page1.Tsfact1.Sobrante.Header1' AS header WITH ;
		Caption = "Sobrante", ;
		FontSize = 8, ;
		Name = "Header1"
		*< END OBJECT: BaseClass="header" />

	ADD OBJECT 'Pageframe1.Page1.Tsfact1.Sobrante.Text1' AS textbox WITH ;
		BackColor = 255,255,255, ;
		BorderStyle = 0, ;
		FontSize = 8, ;
		ForeColor = 0,0,0, ;
		Margin = 0, ;
		Name = "Text1", ;
		ReadOnly = .T., ;
		SelectedBackColor = 247,223,187, ;
		SelectedForeColor = 0,64,128
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page1.Tslabel1' AS tslabel WITH ;
		Alignment = 1, ;
		Caption = "Lista Precio", ;
		FontBold = .F., ;
		Height = 16, ;
		Left = 322, ;
		Name = "Tslabel1", ;
		TabIndex = 3, ;
		Top = 10, ;
		Width = 64, ;
		ZOrderSet = 4
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page1.Tslabel2' AS tslabel WITH ;
		Alignment = 1, ;
		AutoSize = .F., ;
		Caption = "Depósito:", ;
		FontBold = .F., ;
		Height = 16, ;
		Left = 20, ;
		Name = "Tslabel2", ;
		TabIndex = 5, ;
		Top = 34, ;
		Width = 84, ;
		ZOrderSet = 13
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page1.Tslabel4' AS tslabel WITH ;
		Alignment = 1, ;
		AutoSize = .T., ;
		Caption = "Referencia:", ;
		FontBold = .F., ;
		Height = 16, ;
		Left = 46, ;
		Name = "Tslabel4", ;
		TabIndex = 13, ;
		Top = 82, ;
		Width = 58, ;
		ZOrderSet = 1
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page1.txtFecfactu' AS tstextbox WITH ;
		Comment = "", ;
		ControlSource = "st_inventario.fecha", ;
		DateFormat = 13, ;
		editable = .T., ;
		Format = "D", ;
		Height = 23, ;
		Left = 106, ;
		Name = "txtFecfactu", ;
		TabIndex = 4, ;
		Top = 9, ;
		Width = 84, ;
		ZOrderSet = 3
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />
	
	PROCEDURE imprimir
		*!*	m.cpbt_stk = st_movimiento.cpbt_stk
		*!*	m.numero = st_movimiento.numero
		*!*	REPORT FORM st_movistk PREVIEW NOCONSOLE
		
		m.IdComprobante = st_movimiento.IdComprobante
		m.numero = st_movimiento.numero
		m.inventario = st_inventario.idinventario
		REPORT FORM st_movistk PREVIEW NOCONSOLE
	ENDPROC

	PROCEDURE lallowedits_access
		RETURN NVL(st_inventario.cerrado,.f.)
	ENDPROC

	PROCEDURE Pageframe1.Page1.totales.Refresh
		this.parent.tsfact1.sumcolumn()
		this.totalcheque.value = this.parent.tsfact1.totales(1)
		this.txtfaltante.value = this.parent.tsfact1.totales(2)
		this.txtsobrante.value = this.parent.tsfact1.totales(3)
		this.txtresultado.value = this.parent.tsfact1.totales(4)
		DODEFAULT()
	ENDPROC

	PROCEDURE Pageframe1.Page1.Tscommandbutton1.Click
		*!*	SELECT i.idproducto, inventario - cantidad AS resultado, NVL(p.precio, 0) AS precio FROM st_InventarioDet i  ;
		*!*	       LEFT JOIN vt_Precios p ON i.idproducto = p.idproducto AND i.idempresa = p.idempresa AND idlista =  ;
		*!*	       '02' INTO CURSOR cInv
		*!*	SELECT cinv
		
		*!*	SCAN
		*!*	     UPDATE st_InventarioDet SET resultado = cinv.resultado, importe = cinv.precio * cinv.resultado WHERE  ;
		*!*	            idproducto = cinv.idproducto
		*!*	ENDSCAN
		
		
		SELECT st_inventariodet
		SCAN 
			replace resultado WITH NVL(inventario,0) - NVL(cantidad,0)
			
		ENDSCAN
		
		
		
		SELECT st_inventario
		m.IdComprobante = 'EI'
		m.camponro = thisform.camponro
		thisform.camponro = "numero,st_movimiento, IdComprobante =  ?m.IdComprobante "+  ;
		                    " and idempresa = ?oApp.Empresa"
		m.ultimonro = thisform.ultimonro
		*!* m.idmovimiento = 'S' + ALLTRIM(newid('MOV_STOCK', .T.))
		
		m.idmovimiento =  newid('stmovimiento')
		APPEND IN st_movimiento BLANK
		REPLACE idempresa WITH oapp.empresa, idmovimiento WITH m.idmovimiento, IdComprobante WITH m.IdComprobante, numero WITH  ;
		        m.ultimonro, deposito_ent WITH st_inventario.iddeposito, fecha WITH st_inventario.fecha,  ;
		        referencia WITH st_inventario.obs IN st_movimiento
		REPLACE idmovimiento WITH m.idmovimiento, cerrado WITH .T. IN st_inventario
		SELECT st_inventariodet
		SCAN FOR resultado <> 0
		     APPEND IN st_detfactu BLANK
		     REPLACE idempresa WITH oapp.empresa, idmovimiento WITH m.idmovimiento, IdComprobante WITH m.IdComprobante, número  ;
		             WITH m.ultimonro, Iddeposito_ent WITH st_inventario.iddeposito, idproducto WITH  ;
		             st_inventariodet.idproducto, cantidad WITH st_inventariodet.resultado, precio WITH  ;
		             ABS(NVL(st_inventariodet.importe, 0) / st_inventariodet.resultado) IN st_detfactu
		ENDSCAN
		thisform.camponro = m.camponro
		thisform.editar()
	ENDPROC

	PROCEDURE Pageframe1.Page1.Tscommandbutton1.Refresh
		this.enabled =  .NOT. thisform.editmode and !NVL(st_inventario.cerrado,.f.)
	ENDPROC

	PROCEDURE Pageframe1.Page1.Tscommandbutton2.Click
		IF EMPTY(this.parent.txtfecfactu.value)
		     MESSAGEBOX('Indique la fecha para el inventario')
		     RETURN
		ENDIF
		IF EMPTY(this.parent.dep_entrada.value)
		     MESSAGEBOX('Indique el Deposito para el inventario')
		     RETURN
		ENDIF
		m.hfecha = this.parent.txtfecfactu.value
		m.deposito = this.parent.dep_entrada.value
		SET NULLDISPLAY TO ''
		*!*	SELECT fa_detfactu.producto, SUM(IIF(fa_detfactu.deposito_ent = m.deposito AND  NOT  ;
		*!*	       EMPTY(fa_detfactu.deposito_ent), fa_detfactu.cantidad, $0.0000)) AS entrada,  ;
		*!*	       SUM(IIF(fa_detfactu.deposito = m.deposito AND  NOT EMPTY(fa_detfactu.deposito), fa_detfactu.cantidad, $ ;
		*!*	       0.0000)) AS salida FROM datos!fa_detfactu INNER JOIN datos!st_movimiento_base ON  ;
		*!*	       fa_detfactu.idfactura = st_movimiento_base.idmovimiento WHERE st_movimiento_base.idempresa =  ;
		*!*	       oapp.empresa AND fa_detfactu.idempresa = oapp.empresa AND st_movimiento_base.fecha <= m.hfecha GROUP  ;
		*!*	       BY fa_detfactu.producto INTO CURSOR SALDO_STOCK UNION SELECT fa_detfactu.producto,  ;
		*!*	       SUM(IIF(fa_detfactu.deposito_ent = m.deposito AND  NOT EMPTY(fa_detfactu.deposito_ent),  ;
		*!*	       fa_detfactu.cantidad, $0.0000)) AS entrada, SUM(IIF(fa_detfactu.deposito = m.deposito AND  NOT  ;
		*!*	       EMPTY(fa_detfactu.deposito), fa_detfactu.cantidad, $0.0000)) AS salida FROM datos!fa_detfactu INNER  ;
		*!*	       JOIN datos!vt_factura ON fa_detfactu.idfactura = vt_factura.idfactura WHERE vt_factura.idempresa =  ;
		*!*	       oapp.empresa AND fa_detfactu.idempresa = oapp.empresa AND vt_factura.fecha <= m.hfecha GROUP BY  ;
		*!*	       fa_detfactu.producto UNION SELECT fa_detfactu.producto, SUM(IIF(fa_detfactu.deposito_ent = m.deposito  ;
		*!*	       AND  NOT EMPTY(fa_detfactu.deposito_ent), fa_detfactu.cantidad, $0.0000)) AS entrada,  ;
		*!*	       SUM(IIF(fa_detfactu.deposito = m.deposito AND  NOT EMPTY(fa_detfactu.deposito), fa_detfactu.cantidad, $ ;
		*!*	       0.0000)) AS salida FROM datos!fa_detfactu INNER JOIN datos!cp_factura ON fa_detfactu.idfactura =  ;
		*!*	       cp_factura.idfactura WHERE cp_factura.idempresa = oapp.empresa AND fa_detfactu.idempresa =  ;
		*!*	       oapp.empresa AND cp_factura.fecha <= m.hfecha GROUP BY fa_detfactu.producto
		
		*!*	SELECT deposito FROM datos!st_deposito WHERE m.deposito = iddeposito INTO CURSOR xdeposito
		*!*	SELECT ss.producto, st_producto.descripcion, st_producto.unidad, SUM(ss.entrada) AS entrada, SUM(ss.salida)  ;
		*!*	       AS salida FROM saldo_stock ss INNER JOIN datos!st_producto ON ss.producto = st_producto.idproducto  ;
		*!*	       WHERE st_producto.idempresa = oapp.empresa GROUP BY 1 INTO CURSOR xsaldos
		*!*	SELECT ss.producto, ss.descripcion, ss.unidad, entrada, salida FROM xSaldos ss WHERE entrada <> salida ORDER  ;
		       BY producto INTO CURSOR saldos
		*!*	SELECT saldos
		
		
		
		TEXT TO cmdSQL noshow
		SELECT p.IdProducto,Descripcion,Catalogo,Unidad,Cantidad=ISNULL(Cantidad,0),Precio = dbo.VT_TraerPrecio(p.IdEmpresa,p.IdProducto,?st_inventario.idlista)
		      from st_Producto p left join dbo.st_SaldoStock(?oApp.Empresa,null,?st_inventario.iddeposito,?st_inventario.Fecha) s
		                  ON p.IdEmpresa=s.IdEmpresa AND 
		                        p.IdProducto = s.IdProducto 
		      where p.IdEmpresa=?oApp.Empresa                
		            and p.AfectaStock = 1
		            and p.Activo = 1
		            order by p.IdProducto
		            
		
		ENDTEXT
		
		=thisform.runsql(cmdSQL,'Saldos')
		SELECT Saldos
		
		
		
		SCAN
		     INSERT INTO st_InventarioDet (idempresa, idinventario, idproducto, descripcion, cantidad, importe)  ;
		            VALUES (oapp.empresa, st_inventario.idinventario, saldos.Idproducto,  ;
		            saldos.descripcion, NVL(Saldos.Cantidad,0), NVL(Saldos.Precio,0))
		ENDSCAN
		this.parent.tsfact1.refresh()
	ENDPROC

	PROCEDURE Pageframe1.Page1.Tscommandbutton2.Refresh
		this.enabled = thisform.editmode
	ENDPROC

	PROCEDURE Pageframe1.Page1.Tsfact1.Cantidad.txtCantidad.LostFocus
		IF this.tag <> STR(this.value)
		     this.parent.parent.parent.totales.refresh()
		ENDIF
	ENDPROC

	PROCEDURE Pageframe1.Page1.Tsfact1.Inventario.Text1.KeyPress
		LPARAMETERS nkeycode, nshiftaltctrl
		IF nkeycode = 24 .OR. nkeycode = 5
		     KEYBOARD '{ENTER}'
		ENDIF
	ENDPROC

	PROCEDURE Pageframe1.Page1.Tsfact1.Refresh
		DODEFAULT()
		*this.idproducto.enabled = .F.
		this.producto.enabled = .F.
		this.cantidad.enabled = .F.
		this.faltante.enabled = .F.
		this.sobrante.enabled = .F.
		this.importe.enabled = .F.
		this.parent.totales.refresh()
	ENDPROC

ENDDEFINE
