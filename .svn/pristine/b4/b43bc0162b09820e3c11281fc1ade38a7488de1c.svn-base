*--------------------------------------------------------------------------------------------------------------------------------------------------------
* (ES) AUTOGENERADO - ¡¡ATENCIÓN!! - ¡¡NO PENSADO PARA EJECUTAR!! USAR SOLAMENTE PARA INTEGRAR CAMBIOS Y ALMACENAR CON HERRAMIENTAS SCM!!
* (EN) AUTOGENERATED - ATTENTION!! - NOT INTENDED FOR EXECUTION!! USE ONLY FOR MERGING CHANGES AND STORING WITH SCM TOOLS!!
*--------------------------------------------------------------------------------------------------------------------------------------------------------
*< FOXBIN2PRG: Version="1.19" SourceFile="cn_cierre.scx" /> (Solo para binarios VFP 9 / Only for VFP 9 binaries)
*
*
#INCLUDE "..\include\tastrade.h"

DEFINE CLASS dataenvironment AS dataenvironment 
 	*< CLASSDATA: Baseclass="dataenvironment" Timestamp="" Scale="" Uniqueid="" ClassIcon="2" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Cursor2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cursor3" UniqueID="" Timestamp="" />

	DataSource = .NULL.
	Height = 200
	Left = 1
	Name = "Dataenvironment"
	Top = 220
	Width = 520

	ADD OBJECT 'Cursor2' AS cursor WITH ;
		Alias = "vasientos", ;
		BufferModeOverride = 5, ;
		CursorSource = "cnt_asientos", ;
		Database = ..\data\datos.dbc, ;
		Height = 90, ;
		Left = 150, ;
		Name = "Cursor2", ;
		NoDataOnLoad = .T., ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

	ADD OBJECT 'Cursor3' AS cursor WITH ;
		Alias = "vdetalle", ;
		BufferModeOverride = 5, ;
		CursorSource = "cnt_detalle", ;
		Database = ..\data\datos.dbc, ;
		Height = 90, ;
		Left = 290, ;
		Name = "Cursor3", ;
		NoDataOnLoad = .T., ;
		ReadOnly = .F., ;
		Top = 20, ;
		Width = 90
		*< END OBJECT: BaseClass="cursor" />

ENDDEFINE

DEFINE CLASS tsbaseform12 AS tsbaseform OF "..\libs\tsbase.vcx" 
 	*< CLASSDATA: Baseclass="form" Timestamp="" Scale="" Uniqueid="" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Pageframe1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Ts3dshape1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Ts3dshape2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tslabel1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tslabel3" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tslabel4" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tslabel2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.dfecha" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.hfecha" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Ts3dshape3" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tslabel5" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tslabel6" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tslabel7" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.descripcion" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.fecha" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.lblSucursal" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tslabel8" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Ts3dshape4" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tslabel9" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tslabel10" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tslabel11" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Descripcionap" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.fechaap" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Tslabel12" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.Sucursal" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page1.SucursalAp" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page2.P1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page2.P2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page2.P3" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page2.P4" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page2.Tslabel1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page2.Line1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page2.p5" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page3.grdCn_casientos" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page3.grdCn_casientos.Column2.Header1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page3.grdCn_casientos.Column2.Text1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page3.grdCn_casientos.Column3.Header1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page3.grdCn_casientos.Column3.Text1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page3.grdCn_casientos.Column4.Header1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page3.grdCn_casientos.Column4.Text1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page3.grdCn_casientos.Column5.Header1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page3.grdCn_casientos.Column5.Text1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page3.grdCn_casientos.Column6.Header1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page3.grdCn_casientos.Column6.Text1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page3.P1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page3.Line1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page3.txtDebe" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Pageframe1.Page3.txtHaber" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Siguiente" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Anterior" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cancelar" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Tslabel1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Tslabel2" UniqueID="" Timestamp="" />

	*<DefinedPropArrayMethod>
		*m: *balanceo
		*m: *cerrar
		*m: *procesarcierre
		*m: *saldocp
		*m: *saldocr
	*</DefinedPropArrayMethod>

	camponro = número,cn_Asientos,idempresa = ?oApp.Empresa and ejercicio = ?oApp.Ejercicio
	Caption = "Proceso de Cierre de Ejercicio"
	ctoolbar = 
	DataSession = 2
	DoCreate = .T.
	editmode = .T.
	Height = 397
	Name = "Tsbaseform12"
	tabla1 = vAsientos
	tabla2 = vDetalle
	Width = 548
	lblRequerido.Name = "lblRequerido"

	ADD OBJECT 'Anterior' AS tscommandbutton WITH ;
		Caption = "Anterior", ;
		Enabled = .F., ;
		FontBold = .F., ;
		Height = 24, ;
		Left = 295, ;
		Name = "Anterior", ;
		Top = 360, ;
		Width = 76
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'Cancelar' AS tscommandbutton WITH ;
		Caption = "Cancelar", ;
		FontBold = .F., ;
		Height = 24, ;
		Left = 463, ;
		Name = "Cancelar", ;
		Top = 360, ;
		Width = 76
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'Pageframe1' AS pageframe WITH ;
		ErasePage = .T., ;
		Height = 348, ;
		Left = 7, ;
		Name = "Pageframe1", ;
		PageCount = 5, ;
		Tabs = .T., ;
		Top = 0, ;
		Width = 533, ;
		Page1.Caption = "Page1", ;
		Page1.Name = "Page1", ;
		Page2.Caption = "Page2", ;
		Page2.Name = "Page2", ;
		Page3.Caption = "Page3", ;
		Page3.Name = "Page3", ;
		Page4.Caption = "Page4", ;
		Page4.Name = "Page4", ;
		Page5.Caption = "Page5", ;
		Page5.Name = "Page5"
		*< END OBJECT: BaseClass="pageframe" />

	ADD OBJECT 'Pageframe1.Page1.descripcion' AS tstextbox WITH ;
		Alignment = 3, ;
		Height = 22, ;
		Left = 112, ;
		MaxLength = 60, ;
		Name = "descripcion", ;
		Top = 188, ;
		Value = ('Cierre del Ejercicio '+ alltrim(Str(oApp.Ejercicio))), ;
		Width = 360
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page1.Descripcionap' AS tstextbox WITH ;
		Alignment = 3, ;
		Height = 22, ;
		Left = 112, ;
		MaxLength = 60, ;
		Name = "Descripcionap", ;
		Top = 272, ;
		Value = ('Apertura del Ejercicio '+ alltrim(Str(oApp.Ejercicio + 1))), ;
		Width = 360
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page1.dfecha' AS tstextbox WITH ;
		Alignment = 3, ;
		editable = .F., ;
		Enabled = .F., ;
		Left = 112, ;
		Name = "dfecha", ;
		Top = 80, ;
		Value = (oApp.InicioEjercicio)
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page1.fecha' AS tstextbox WITH ;
		Alignment = 3, ;
		editable = .T., ;
		Enabled = .T., ;
		Left = 112, ;
		Name = "fecha", ;
		Top = 165, ;
		Value = (date(oApp.Ejercicio,12,31))
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page1.fechaap' AS tstextbox WITH ;
		Alignment = 3, ;
		editable = .T., ;
		Enabled = .T., ;
		Left = 112, ;
		Name = "fechaap", ;
		Top = 248, ;
		Value = (date(oApp.Ejercicio+1 ,1,2))
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page1.hfecha' AS tstextbox WITH ;
		Alignment = 3, ;
		editable = .T., ;
		Enabled = .T., ;
		Left = 112, ;
		Name = "hfecha", ;
		Top = 104, ;
		Value = (date(oApp.Ejercicio,12,30))
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page1.lblSucursal' AS tslabel WITH ;
		Alignment = 0, ;
		Caption = "Sucursal", ;
		Height = 16, ;
		Left = 220, ;
		Name = "lblSucursal", ;
		TabIndex = 6, ;
		Top = 164, ;
		Visible = .T., ;
		Width = 50
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page1.Sucursal' AS cbosucursal WITH ;
		Left = 293, ;
		Name = "Sucursal", ;
		Top = 164, ;
		Visible = .T.
		*< END OBJECT: ClassLib="..\libs\futura.vcx" BaseClass="combobox" />

	ADD OBJECT 'Pageframe1.Page1.SucursalAp' AS cbosucursal WITH ;
		cursor = xcSucursalAp, ;
		Left = 294, ;
		Name = "SucursalAp", ;
		Top = 247, ;
		Visible = .T.
		*< END OBJECT: ClassLib="..\libs\futura.vcx" BaseClass="combobox" />

	ADD OBJECT 'Pageframe1.Page1.Ts3dshape1' AS ts3dshape WITH ;
		Height = 39, ;
		Left = 11, ;
		Name = "Ts3dshape1", ;
		Top = 17, ;
		Width = 509
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="shape" />

	ADD OBJECT 'Pageframe1.Page1.Ts3dshape2' AS ts3dshape WITH ;
		Height = 76, ;
		Left = 11, ;
		Name = "Ts3dshape2", ;
		Top = 64, ;
		Width = 509
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="shape" />

	ADD OBJECT 'Pageframe1.Page1.Ts3dshape3' AS ts3dshape WITH ;
		Height = 73, ;
		Left = 11, ;
		Name = "Ts3dshape3", ;
		Top = 151, ;
		Width = 509
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="shape" />

	ADD OBJECT 'Pageframe1.Page1.Ts3dshape4' AS ts3dshape WITH ;
		Height = 74, ;
		Left = 11, ;
		Name = "Ts3dshape4", ;
		Top = 234, ;
		Width = 508
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="shape" />

	ADD OBJECT 'Pageframe1.Page1.Tslabel1' AS tslabel WITH ;
		Alignment = 0, ;
		Caption = "Haga copias de sus datos antes de continuar con el proceso de cierre del ejercicio. ", ;
		FontBold = .F., ;
		Height = 15, ;
		Left = 28, ;
		Name = "Tslabel1", ;
		Top = 29, ;
		Width = 480, ;
		WordWrap = .T.
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page1.Tslabel10' AS tslabel WITH ;
		Alignment = 0, ;
		Caption = "Descripción:", ;
		Height = 22, ;
		Left = 39, ;
		Name = "Tslabel10", ;
		Top = 272, ;
		Width = 72
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page1.Tslabel11' AS tslabel WITH ;
		Alignment = 0, ;
		BackStyle = 1, ;
		Caption = "Asiento de Apertura", ;
		Height = 22, ;
		Left = 39, ;
		Name = "Tslabel11", ;
		Top = 228, ;
		Width = 121
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page1.Tslabel12' AS tslabel WITH ;
		Alignment = 0, ;
		Caption = "Sucursal", ;
		Height = 16, ;
		Left = 220, ;
		Name = "Tslabel12", ;
		TabIndex = 6, ;
		Top = 248, ;
		Visible = .T., ;
		Width = 50
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page1.Tslabel2' AS tslabel WITH ;
		Alignment = 0, ;
		BackStyle = 1, ;
		Caption = "Periodo a cerrar", ;
		Height = 22, ;
		Left = 39, ;
		Name = "Tslabel2", ;
		Top = 58, ;
		Width = 92
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page1.Tslabel3' AS tslabel WITH ;
		Alignment = 0, ;
		Caption = "Desde:", ;
		Height = 22, ;
		Left = 40, ;
		Name = "Tslabel3", ;
		Top = 80, ;
		Width = 48
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page1.Tslabel4' AS tslabel WITH ;
		Alignment = 0, ;
		Caption = "Hasta:", ;
		Height = 22, ;
		Left = 40, ;
		Name = "Tslabel4", ;
		Top = 104, ;
		Width = 48
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page1.Tslabel5' AS tslabel WITH ;
		Alignment = 0, ;
		Caption = "Fecha:", ;
		Height = 22, ;
		Left = 40, ;
		Name = "Tslabel5", ;
		Top = 164, ;
		Width = 48
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page1.Tslabel6' AS tslabel WITH ;
		Alignment = 0, ;
		Caption = "Descripción:", ;
		Height = 22, ;
		Left = 39, ;
		Name = "Tslabel6", ;
		Top = 188, ;
		Width = 72
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page1.Tslabel7' AS tslabel WITH ;
		Alignment = 0, ;
		BackStyle = 1, ;
		Caption = "Asiento de Cierre", ;
		Height = 22, ;
		Left = 39, ;
		Name = "Tslabel7", ;
		Top = 145, ;
		Width = 97
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page1.Tslabel8' AS tslabel WITH ;
		Alignment = 0, ;
		BackStyle = 1, ;
		Caption = "Atención", ;
		Height = 22, ;
		Left = 40, ;
		Name = "Tslabel8", ;
		Top = 10, ;
		Width = 54
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page1.Tslabel9' AS tslabel WITH ;
		Alignment = 0, ;
		Caption = "Fecha:", ;
		Height = 22, ;
		Left = 40, ;
		Name = "Tslabel9", ;
		Top = 247, ;
		Width = 48
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page2.Line1' AS line WITH ;
		BorderColor = 0,0,128, ;
		BorderWidth = 2, ;
		Height = 0, ;
		Left = 6, ;
		Name = "Line1", ;
		Top = 26, ;
		Width = 522
		*< END OBJECT: BaseClass="line" />

	ADD OBJECT 'Pageframe1.Page2.P1' AS tslabel WITH ;
		Alignment = 0, ;
		BackColor = 0,128,0, ;
		Caption = "Verificando Balanceo de Asientos", ;
		FontBold = .F., ;
		Height = 22, ;
		Left = 40, ;
		Name = "P1", ;
		Top = 60, ;
		Width = 312
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page2.P2' AS tslabel WITH ;
		Alignment = 0, ;
		Caption = "Calculando Saldos de Cuentas de Resultado", ;
		FontBold = .F., ;
		Height = 22, ;
		Left = 40, ;
		Name = "P2", ;
		Top = 84, ;
		Width = 312
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page2.P3' AS tslabel WITH ;
		Alignment = 0, ;
		Caption = "Calculando Saldos de Cuentas Patrimoniales", ;
		FontBold = .F., ;
		Height = 22, ;
		Left = 40, ;
		Name = "P3", ;
		Top = 108, ;
		Width = 312
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page2.P4' AS tslabel WITH ;
		Alignment = 0, ;
		Caption = "Generando asientos de cierre", ;
		FontBold = .F., ;
		Height = 22, ;
		Left = 40, ;
		Name = "P4", ;
		Top = 132, ;
		Width = 312
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page2.p5' AS tslabel WITH ;
		Alignment = 0, ;
		Caption = "Generando asientos de apertura", ;
		FontBold = .F., ;
		Height = 22, ;
		Left = 40, ;
		Name = "p5", ;
		Top = 155, ;
		Width = 312
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page2.Tslabel1' AS tslabel WITH ;
		Alignment = 0, ;
		BackColor = 0,128,0, ;
		Caption = "Procesos", ;
		FontBold = .T., ;
		ForeColor = 0,0,128, ;
		Height = 22, ;
		Left = 6, ;
		Name = "Tslabel1", ;
		Top = 9, ;
		Width = 192
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page3.grdCn_casientos' AS tsgrid WITH ;
		ColumnCount = 5, ;
		FontSize = 8, ;
		GridLines = 2, ;
		Height = 251, ;
		Left = 4, ;
		Name = "grdCn_casientos", ;
		Panel = 1, ;
		ReadOnly = .T., ;
		RecordSource = "", ;
		RecordSourceType = 1, ;
		RowHeight = 20, ;
		ScrollBars = 2, ;
		Top = 42, ;
		Width = 525, ;
		Column1.ControlSource = "", ;
		Column1.FontSize = 8, ;
		Column1.InputMask = "99,999", ;
		Column1.Name = "Column2", ;
		Column1.ReadOnly = .T., ;
		Column1.Width = 45, ;
		Column2.ControlSource = "", ;
		Column2.FontSize = 8, ;
		Column2.Name = "Column3", ;
		Column2.ReadOnly = .T., ;
		Column2.Width = 66, ;
		Column3.ControlSource = "", ;
		Column3.FontSize = 8, ;
		Column3.Name = "Column4", ;
		Column3.ReadOnly = .T., ;
		Column3.Width = 194, ;
		Column4.ControlSource = "", ;
		Column4.FontSize = 8, ;
		Column4.InputMask = "99,999,999,999.99", ;
		Column4.Name = "Column5", ;
		Column4.ReadOnly = .T., ;
		Column4.Width = 99, ;
		Column5.ControlSource = "", ;
		Column5.FontSize = 8, ;
		Column5.InputMask = "99,999,999,999.99", ;
		Column5.Name = "Column6", ;
		Column5.ReadOnly = .T., ;
		Column5.Width = 97
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="grid" />

	ADD OBJECT 'Pageframe1.Page3.grdCn_casientos.Column2.Header1' AS header WITH ;
		Caption = "Asiento", ;
		FontSize = 8, ;
		Name = "Header1"
		*< END OBJECT: BaseClass="header" />

	ADD OBJECT 'Pageframe1.Page3.grdCn_casientos.Column2.Text1' AS textbox WITH ;
		BackColor = 255,255,255, ;
		BorderStyle = 0, ;
		FontSize = 8, ;
		ForeColor = 0,0,0, ;
		Margin = 0, ;
		Name = "Text1", ;
		ReadOnly = .T., ;
		SelectedBackColor = 247,223,187, ;
		SelectedForeColor = 0,64,128
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page3.grdCn_casientos.Column3.Header1' AS header WITH ;
		Caption = "Fecha", ;
		FontSize = 8, ;
		Name = "Header1"
		*< END OBJECT: BaseClass="header" />

	ADD OBJECT 'Pageframe1.Page3.grdCn_casientos.Column3.Text1' AS textbox WITH ;
		BackColor = 255,255,255, ;
		BorderStyle = 0, ;
		FontSize = 8, ;
		ForeColor = 0,0,0, ;
		Margin = 0, ;
		Name = "Text1", ;
		ReadOnly = .T., ;
		SelectedBackColor = 247,223,187, ;
		SelectedForeColor = 0,64,128
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page3.grdCn_casientos.Column4.Header1' AS header WITH ;
		Caption = "Descripción", ;
		FontSize = 8, ;
		Name = "Header1"
		*< END OBJECT: BaseClass="header" />

	ADD OBJECT 'Pageframe1.Page3.grdCn_casientos.Column4.Text1' AS textbox WITH ;
		BackColor = 255,255,255, ;
		BorderStyle = 0, ;
		FontSize = 8, ;
		ForeColor = 0,0,0, ;
		Margin = 0, ;
		Name = "Text1", ;
		ReadOnly = .T., ;
		SelectedBackColor = 247,223,187, ;
		SelectedForeColor = 0,64,128
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page3.grdCn_casientos.Column5.Header1' AS header WITH ;
		Caption = "Total Debe", ;
		FontSize = 8, ;
		Name = "Header1"
		*< END OBJECT: BaseClass="header" />

	ADD OBJECT 'Pageframe1.Page3.grdCn_casientos.Column5.Text1' AS textbox WITH ;
		BackColor = 255,255,255, ;
		BorderStyle = 0, ;
		FontSize = 8, ;
		ForeColor = 0,0,0, ;
		Margin = 0, ;
		Name = "Text1", ;
		ReadOnly = .T., ;
		SelectedBackColor = 247,223,187, ;
		SelectedForeColor = 0,64,128
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page3.grdCn_casientos.Column6.Header1' AS header WITH ;
		Caption = "Total Haber", ;
		FontSize = 8, ;
		Name = "Header1"
		*< END OBJECT: BaseClass="header" />

	ADD OBJECT 'Pageframe1.Page3.grdCn_casientos.Column6.Text1' AS textbox WITH ;
		BackColor = 255,255,255, ;
		BorderStyle = 0, ;
		FontSize = 8, ;
		ForeColor = 0,0,0, ;
		Margin = 0, ;
		Name = "Text1", ;
		ReadOnly = .T., ;
		SelectedBackColor = 247,223,187, ;
		SelectedForeColor = 0,64,128
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page3.Line1' AS line WITH ;
		BorderColor = 0,0,128, ;
		BorderWidth = 2, ;
		Height = 0, ;
		Left = 6, ;
		Name = "Line1", ;
		Top = 26, ;
		Width = 518
		*< END OBJECT: BaseClass="line" />

	ADD OBJECT 'Pageframe1.Page3.P1' AS tslabel WITH ;
		Alignment = 0, ;
		BackColor = 0,128,0, ;
		Caption = "Asientos no balanceados", ;
		FontBold = .T., ;
		ForeColor = 0,0,128, ;
		Height = 22, ;
		Left = 6, ;
		Name = "P1", ;
		Top = 9, ;
		Width = 192
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Pageframe1.Page3.txtDebe' AS tstextbox WITH ;
		InputMask = "99,999,999,999.99", ;
		Left = 311, ;
		Name = "txtDebe", ;
		ReadOnly = .T., ;
		Top = 294
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Pageframe1.Page3.txtHaber' AS tstextbox WITH ;
		InputMask = "99,999,999,999.99", ;
		Left = 412, ;
		Name = "txtHaber", ;
		ReadOnly = .T., ;
		Top = 294
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="textbox" />

	ADD OBJECT 'Siguiente' AS tscommandbutton WITH ;
		Caption = "Siguiente ", ;
		FontBold = .F., ;
		Height = 24, ;
		Left = 379, ;
		Name = "Siguiente", ;
		Top = 360, ;
		Width = 76
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'Tslabel1' AS tslabel WITH ;
		Alignment = 0, ;
		Caption = "3", ;
		FontBold = .F., ;
		FontName = "Webdings", ;
		FontSize = 12, ;
		Height = 22, ;
		Left = 297, ;
		Name = "Tslabel1", ;
		Top = 362, ;
		Width = 12
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />

	ADD OBJECT 'Tslabel2' AS tslabel WITH ;
		Alignment = 0, ;
		Caption = "4", ;
		FontBold = .F., ;
		FontName = "Webdings", ;
		FontSize = 12, ;
		Height = 22, ;
		Left = 439, ;
		Name = "Tslabel2", ;
		Top = 362, ;
		Width = 12
		*< END OBJECT: ClassLib="..\libs\tsbase.vcx" BaseClass="label" />
	
	PROCEDURE balanceo
		 LOCAL llerror, lcresp
		 this.lockscreen = .T.
		 SELECT COUNT(tipo) AS cantidad FROM asientos_base WHERE idempresa=oapp.empresa AND ejercicio=oapp.ejercicio AND tipo='C' INTO CURSOR xcCerrado
		 IF xccerrado.cantidad>0
		    lcresp = MESSAGEBOX('Se ha encontrado un cierre anterior a este proceso.'+CHR(13)+'Desea eliminarlo antes de continuar?', 036, "Futura Software")
		    IF lcresp=6
		       cmdsql = "Delete from cn_asientos where idempresa = ?oApp.Empresa "+"and  ((ejercicio = ?oApp.ejercicio and tipo='C') "+"	 or (Ejercicio = ?oApp.Ejercicio + 1	and tipo = 'A'))"
		       IF sql(cmdsql)<0
		          lleror = .T.
		       ELSE
		          = sql('Select * from cn_asientos where idEmpresa = ?oapp.Empresa and ejercicio=?oApp.Ejercicio', 'asientos_Base')
		          = sql('Select * from cn_detalle where idEmpresa = ?oapp.Empresa and ejercicio=?oApp.Ejercicio', 'Detalle_Base')
		          lleror = .F.
		       ENDIF
		    ELSE
		       this.lockscreen = .F.
		       lleror = .T.
		    ENDIF
		 ENDIF
		 WITH thisform.pageframe1.page2
		    .refresh()
		    .p1.fontbold = .T.
		    this.lockscreen = .F.
		    WAIT WINDOW TIMEOUT 1 ''
		    IF  .NOT. llerror
		       SELECT asientos_base.número AS número, asientos_base.fecha, asientos_base.descripción, SUM(detalle_base.debe) AS total_debe, SUM(detalle_base.haber) AS total_haber, asientos_base.idempresa FROM asientos_base INNER JOIN DETALLE_BASE ON asientos_base.idempresa=detalle_base.idempresa WHERE asientos_base.idasiento=detalle_base.idasiento AND (asientos_base.idempresa=oapp.empresa AND asientos_base.ejercicio=oapp.ejercicio AND detalle_base.cuenta<>SPACE(5)) GROUP BY 1, 2, 3, 6 HAVING total_debe<>total_haber INTO CURSOR cn_cAsientos
		       llerror = RECCOUNT('cn_cAsientos')<>0
		       thisform.pageframe1.page3.grdcn_casientos.recordsourcetype = 1
		       thisform.pageframe1.page3.grdcn_casientos.recordsource = 'cn_cAsientos'
		       SELECT cn_casientos
		       CALCULATE SUM(total_debe), SUM(total_haber) TO tdebe, thaber 
		       thisform.pageframe1.page3.txtdebe.value = tdebe
		       thisform.pageframe1.page3.txthaber.value = thaber
		       llerror = tdebe<>thaber
		    ENDIF
		    IF  .NOT. llerror
		       .p1.forecolor = RGB(0, 128, 0)
		    ELSE
		       .p1.forecolor = RGB(255, 0, 0)
		    ENDIF
		 ENDWITH
		 RETURN llerror
	ENDPROC

	PROCEDURE cerrar
	ENDPROC

	PROCEDURE Init
		 DODEFAULT()
		 thisform.pageframe1.tabs = .F.
	ENDPROC

	PROCEDURE procesarcierre
		Local lerror
		
		**VG 08/06/2010
		**Corregimos los errores de fecha que pudo haber al asentar
		
		=Sql('update cn_asientos set Ejercicio = YEAR(Fecha) where IdEmpresa=?oapp.Empresa and YEAR(fecha)=?oApp.Ejercicio and YEAR(fecha)<>ejercicio','')
		
		**VG 23/05/2013
		**Agregamos nuevas cuentas en el nuevo ejercicio por si no existan
		
		
		
		
		* =sql('update cn_asientos set Ejercicio = YEAR(Fecha) where IdEmpresa=?oapp.Empresa and YEAR(fecha)=?oApp.Ejercicio')
		TEXT TO cmdSQL noshow
			 update cn_detalle
			set ejercicio = a.Ejercicio
			from cn_asientos a
			where cn_detalle.IdAsiento = a.IdAsiento
			and cn_detalle.Ejercicio<> a.Ejercicio
			and cn_detalle.idEmpresa=?oApp.Empresa
			and YEAR(a.Fecha) = ?oApp.Ejercicio
		
		ENDTEXT
		=Sql(cmdSQL,'')
		
		
		= Sql('Select * from cn_asientos where idEmpresa = ?oapp.Empresa and ejercicio=?oApp.Ejercicio', 'asientos_Base')
		= Sql('Select * from cn_detalle where idEmpresa = ?oapp.Empresa and ejercicio=?oApp.Ejercicio', 'Detalle_Base')
		= Sql('Select * from cn_cuentas where idEmpresa = ?oapp.Empresa and Ejercicio = ?oApp.Ejercicio', 'cuentas_Base')
		= Sql('Select * from empresa where idEmpresa = ?oapp.Empresa ', 'Empresa')
		lerror = This.balanceo()
		Set ENGINEBEHAVIOR 70
		If lerror
			Thisform.pageframe1.page3.SetFocus()
			Thisform.pageframe1.ActivePage = 3
			Return
		Endif
		Local xdecimales, vperíodo, vfechai, vfechaf, vsucursal, lnresultado
		Local paginai, paginaf
		xdecimales = 0
		xempresa = oapp.empresa
		m.dfecha = Thisform.pageframe1.page1.dfecha.Value
		m.hfecha = Thisform.pageframe1.page1.hfecha.Value
		vdescripción = Left(Thisform.pageframe1.page1.descripcion.Value+Space(60), 60)
		m.fecha = Thisform.pageframe1.page1.fecha.Value
		m.sucursal = Thisform.pageframe1.page1.sucursal.Value
		vdescripciónap = Left(Thisform.pageframe1.page1.descripcionap.Value+Space(60), 60)
		m.fechaap = Thisform.pageframe1.page1.fechaap.Value
		m.sucursalap = Thisform.pageframe1.page1.sucursalap.Value
		Thisform.pageframe1.page2.p2.FontBold = .T.
		Wait Window Timeout 0.5 ''
		Select d.cuenta, Sum(d.debe-d.haber) As saldo From asientos_base a, detalle_base d, cuentas_base c Where Between(a.fecha, m.dfecha, m.hfecha) And a.idasiento=d.idasiento And d.cuenta=c.cuenta And a.ejercicio=oapp.ejercicio And a.idempresa=oapp.empresa And c.idempresa=oapp.empresa And Left(d.cuenta, 1)='1' Into Cursor xactivo NOFILTER
		Select d.cuenta, Sum(d.debe-d.haber) As saldo From asientos_base a, detalle_base d, cuentas_base c Where Between(a.fecha, m.dfecha, m.hfecha) And a.idasiento=d.idasiento And d.cuenta=c.cuenta And a.ejercicio=oapp.ejercicio And a.idempresa=oapp.empresa And c.idempresa=oapp.empresa And (Left(d.cuenta, 1)='2' Or Left(d.cuenta, 1)='3') Into Cursor xpasivo NOFILTER
		lnresultado = xactivo.saldo+xpasivo.saldo
		If lnresultado<>0
			lerror = Empty(leerparam('resultado', 'empresa', 'idempresa=?oApp.Empresa'))
		Endif
		If lerror
			Thisform.pageframe1.page2.p2.ForeColor = Rgb(255, 0, 0)
			Thisform.pageframe1.page2.p2.Caption = "Debe indicar la cuenta de resultado de la Empresa"
			Return
		Else
			Thisform.pageframe1.page2.p2.ForeColor = Rgb(0, 128, 0)
			Thisform.pageframe1.page2.p3.FontBold = .T.
		Endif
		Wait Window Timeout 0.5 ''
		Select Left(d.cuenta, 1) As xnivel, d.cuenta, d.centro, Sum(d.debe-d.haber) As saldo, c.descripción, xdecimales As dec, "Cierre Preliminar" As titulo From asientos_base a, detalle_base d, cuentas_base c Where Between(a.fecha, m.dfecha, m.hfecha) And a.idasiento=d.idasiento And d.cuenta=c.cuenta And a.ejercicio=oapp.ejercicio And a.idempresa=oapp.empresa And c.idempresa=oapp.empresa Group By 2, 3 Order By 1 Desc Into Cursor xsaldo NOFILTER
		Select xsaldo
		vresultado = 0
		vperganancia = 0
		Set Console Off
		Sum (saldo) To vresultado For Left(cuenta, 1)<"3"
		Sum (saldo) To vperganancia For Left(cuenta, 1)>="3"
		Thisform.pageframe1.page2.p3.ForeColor = Rgb(0, 128, 0)
		Thisform.pageframe1.page2.p4.FontBold = .T.
		Wait Window Timeout 1 ''
		Set Console On
		vnúmero = Thisform.ultimonro
		If vperganancia<>0
			Select Iif(Left(cuenta, 1)>"3", vnúmero, vnúmero+1) As número, Iif(saldo<0, "1", "2") As tipo, cuenta, centro, descripción, Iif(saldo>0, $0.0000, Abs(saldo)) As haber, Iif(saldo<0, $0.0000, Abs(saldo)) As debe, xdecimales As dec, m.fecha As fecha, vdescripción As Nota, m.sucursal As sucursal, xempresa As empresa, "Cierre Preliminar" As titulo; 
			From xsaldo Where saldo<>0 ;
			Union All Select vnúmero As número, Iif(lnresultado<0, "1", "2") As tipo, empresa.resultado As cuenta, Space(5) As centro, Iif(Isnull(cuentas_base.descripción), Space(60), cuentas_base.descripción) As descripción, Iif(lnresultado<0, lnresultado*-1, $0.0000) As debe, Iif(lnresultado>0, lnresultado, $0.0000) As haber, xdecimales As dec, m.fecha As fecha,; 
			vdescripción As Nota, m.sucursal As sucursal, xempresa As empresa, "Cierre Preliminar" As titulo From empresa, cuentas_base Where lnresultado<>0 And empresa.resultado=cuentas_base.cuenta And cuentas_base.idempresa=oapp.empresa And empresa.idempresa=oapp.empresa Union All Select vnúmero+1 As número, Iif(lnresultado>0, "1", "2") As tipo, empresa.resultado As cuenta, ;
			Space(5) As centro, Iif(Isnull(cuentas_base.descripción), Space(60), cuentas_base.descripción) As descripción, Iif(lnresultado<0, $0.0000, lnresultado) As debe, Iif(lnresultado>0, $0.0000, lnresultado*-1) As haber, xdecimales As dec, m.fecha As fecha, vdescripción As Nota, m.sucursal As sucursal, xempresa As empresa, "Cierre Preliminar" As titulo ;
			From empresa, cuentas_base Where lnresultado<>0 And empresa.resultado=cuentas_base.cuenta And cuentas_base.idempresa=oapp.empresa And empresa.idempresa=oapp.empresa Union All Select vnúmero+1 As número, Iif(vperganancia<0, "2", "1") As tipo, pérdida As cuenta, Space(5) As centro, Iif(Isnull(descripción), Space(60), descripción) As descripción, $0.0000 As debe, Abs(vperganancia) As haber, xdecimales As dec, m.fecha As fecha, vdescripción As Nota, m.sucursal As sucursal, xempresa As empresa, "Cierre Preliminar" As titulo From empresa Left Join cuentas_base On empresa.pérdida=cuentas_base.cuenta WHERE vperganancia<0 AND cuentas_base.idempresa=oapp.empresa AND empresa.empresa=oapp.empresa ORDER BY 1, 2, 3 INTO CURSOR xasientoscierre
		 ELSE
		    SELECT IIF(LEFT(cuenta, 1)<"3", vnúmero, vnúmero+1) AS número, IIF(saldo<0, "2", "1") AS tipo, cuenta, centro, descripción, IIF(saldo>0, $0.0000, ABS(saldo)) AS debe, IIF(saldo<0, $0.0000, ABS(saldo)) AS haber, dec, m.fecha AS fecha, vdescripción AS nota, m.sucursal AS sucursal, xempresa AS empresa, titulo FROM xsaldo WHERE saldo<>0 ORDER BY 1, 2 DESC, 3 INTO CURSOR xasientoscierre
		 ENDIF
		
		 WAIT WINDOW TIMEOUT 1 ''
		
		 thisform.pageframe1.page2.p4.forecolor = RGB(0, 128, 0)
		 thisform.pageframe1.page2.p5.fontbold = .T.
		 thisform.tag = thisform.camponro
		 this.camponro = "número,cn_Asientos,idempresa = ?oApp.Empresa and ejercicio = ?oApp.Ejercicio + 1"
		 vnúmeroap = thisform.ultimonro
		 this.camponro = this.tag
		 SELECT vnúmeroap AS número, IIF(debe>haber, '2', '1') AS tipo, cuenta, centro, descripción, haber AS haber, debe AS debe, dec, m.fechaap AS fecha, vdescripciónap AS nota, m.sucursalap AS sucursal, xempresa AS empresa, "Cierre Preliminar" AS titulo FROM xasientoscierre WHERE número=vnúmero+1 ORDER BY 1, 2 DESC, 3 INTO CURSOR xasientosApertura
		 SELECT xasientoscierre.*, 'C' AS tipoasiento, oapp.ejercicio AS ejercicio FROM xasientoscierre UNION ALL SELECT xasientosapertura.*, 'A' AS tipoasiento, oapp.ejercicio+1 AS ejercicio FROM xAsientosApertura ORDER BY 1, 2, 3 INTO CURSOR xasientos
		 thisform.pageframe1.page2.p5.forecolor = RGB(0, 128, 0)
		 WAIT WINDOW TIMEOUT 1 ''
		 REPORT FORM CN_cierre TO PRINTER PROMPT PREVIEW
		 SELECT xasientos
		 lnanswer = MESSAGEBOX("Desea confirmar el Cierre del Ejercicio?", 036, "Futura Software")
		 IF lnanswer<>6
		    RETURN
		 ENDIF
		 GOTO TOP
		 SELECT * FROM xAsientos GROUP BY número INTO CURSOR xcCabecera
		 SELECT xccabecera
		 SCAN
		    SELECT vasientos
		    APPEND BLANK
		    REPLACE idempresa WITH oapp.empresa, idasiento WITH newid('CNT_ASIENTOS'), número WITH xccabecera.número, ejercicio WITH xccabecera.ejercicio, sucursal WITH xccabecera.sucursal, fecha WITH xccabecera.fecha, tipo WITH xccabecera.tipoasiento, descripción WITH xccabecera.nota
		    SELECT xasientos
		    SCAN FOR xasientos.número=xccabecera.número
		       SELECT vdetalle
		       APPEND BLANK
		       REPLACE idempresa WITH oapp.empresa, idasiento WITH vasientos.idasiento, ejercicio WITH vasientos.ejercicio, cuenta WITH xasientos.cuenta, detalle WITH vasientos.descripción, debe WITH xasientos.debe, haber WITH xasientos.haber, centro WITH xasientos.centro
		       SELECT xasientos
		    ENDSCAN
		 ENDSCAN
		 IF  .NOT. this.save()
		    RETURN
		 ENDIF
		 SET ENGINEBEHAVIOR 90
		 MESSAGEBOX('Proceso Finalizado con éxito.', 64, "Futura Software")
		 thisform.release()
	ENDPROC

	PROCEDURE saldocp
	ENDPROC

	PROCEDURE saldocr
	ENDPROC

	PROCEDURE Anterior.Click
		 WITH thisform.pageframe1
		    DO CASE
		       CASE .activepage=2
		          .activepage = 1
		          this.enabled = .F.
		       CASE .activepage=3
		          .activepage = 2
		          this.enabled = .T.
		    ENDCASE
		 ENDWITH
	ENDPROC

	PROCEDURE Cancelar.Click
		 thisform.release()
	ENDPROC

	PROCEDURE Pageframe1.Page1.Activate
		 WITH this.parent.page2
		    .p1.fontbold = .F.
		    .p1.forecolor = RGB(0, 0, 0)
		    .p2.fontbold = .F.
		    .p2.forecolor = RGB(0, 0, 0)
		    .p3.fontbold = .F.
		    .p3.forecolor = RGB(0, 0, 0)
		    .p4.fontbold = .F.
		    .p4.forecolor = RGB(0, 0, 0)
		 ENDWITH
	ENDPROC

	PROCEDURE Siguiente.Click
		 WITH thisform.pageframe1
		    DO CASE
		       CASE .activepage=1
		          .activepage = 2
		          .page2.setfocus()
		          thisform.anterior.enabled = .T.
		          thisform.procesarcierre()
		    ENDCASE
		 ENDWITH
	ENDPROC

ENDDEFINE
